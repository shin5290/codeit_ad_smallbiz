# 소상공인 광고 콘텐츠 생성 서비스 - 아키텍처 및 역할 분담

### 전체 아키텍처

```
┌─────────────────────────────────────────┐
│     Frontend (Streamlit / Cloud Run)    │
│  - 사용자 입력 인터페이스                 │
└─────────────────────────────────────────┘
                    ↕ REST API
┌─────────────────────────────────────────┐
│     Backend API (FastAPI / Cloud Run)   │
│  - API 라우팅 및 비즈니스 로직            │
└─────────────────────────────────────────┘
                    ↕
┌──────────────────┬──────────────────────┐
│  Image Generator │  Text Generator      │
│  (GCP L4 GPU)    │  (GPT API)           │
└──────────────────┴──────────────────────┘
                    ↕
┌─────────────────────────────────────────┐
│    GCS (이미지) + PostgreSQL (메타)      │
└─────────────────────────────────────────┘
```

---

### 기술 스택

| 레이어 | 기술 |
| --- | --- |
| Frontend | Streamlit |
| Backend | FastAPI, SQLAlchemy, PostgreSQL |
| 이미지 생성 | SDXL/QWEN/Flux (Diffusers), ControlNet |
| 텍스트 생성 | OpenAI GPT-4o |
| Infrastructure | GCP (Cloud Run, Compute Engine L4, GCS), Docker |

---

### 5인 역할 분담

### ① Frontend 담당

**영역:** `frontend/`

**업무:** Streamlit UI 전체, 결과 렌더링

**산출:** 모든 페이지, 사용자 플로우

**포인트:** "직관적 UI/UX 설계 및 구현"

---

### ② Backend 담당

**영역:** `backend/api/`, `backend/models/`, `backend/services/`

**업무:**

- FastAPI RESTful API 구현
- DB 스키마 설계 및 CRUD
- 이미지/텍스트 생성 모듈 호출 및 결과 저장

**데이터베이스 스키마:**

**generation_history 테이블**

- id, user_id, content_type (image/text)
- input_text, input_image_url (선택)
- output_url, generation_method
- style, industry, created_at

**산출:** RESTful API, PostgreSQL 스키마

**포인트:** "확장 가능한 백엔드 아키텍처 및 데이터 관리"

---

### ③ 이미지 생성 담당

**영역:** `models/image_generation/`

**업무:**

- 자동 모델 선택 로직 (입력 분석 → t2i/ControlNet)
- 이미지 품질 분석 및 전처리 (배경 제거, 밝기 조정)
- SDXL/QWEN/Flux.1 + ControlNet 파이프라인 구현
- 이미지 후처리 (리사이징, 압축, 텍스트 오버레이)

**UnifiedImageGenerator 클래스 주요 함수:**

- `generate()` - 자동 모델 선택 및 이미지 생성 총괄
- `analyze_image_quality()` - 이미지 품질 분석
- `decide_generation_method()` - t2i/ControlNet 자동 선택
- `preprocess_image()` - 배경 제거, 밝기 조정
- `generate_t2i()` - 텍스트→이미지 생성
- `generate_controlnet()` - ControlNet 기반 생성
- `postprocess_image()` - 리사이징, 압축, 텍스트 오버레이

**산출:** `UnifiedImageGenerator` 클래스

**포인트:** "SDXL/QWEN/Flux.1 중 하나의 모델 기반 이미지 생성 및 자동 선택 알고리즘"

---

### ④ 텍스트 & 프롬프트 담당

**영역:** `models/text_generation/`

**업무:**

- GPT API 연동 및 광고 카피 생성
- 이미지 생성용 프롬프트 템플릿 설계 (업종별/스타일별)
- 텍스트 생성용 프롬프트 템플릿 설계 (톤앤매너별)
- 응답 파싱 및 검증

**PromptTemplateManager 클래스 주요 함수:**

- `get_image_prompt()` - 이미지 생성용 프롬프트 반환
- `get_text_prompt()` - 텍스트 생성용 프롬프트 반환
- `load_templates()` - 템플릿 DB 로드
- `enhance_prompt()` - 업종/스타일 기반 프롬프트 보강

**TextGenerator 클래스 주요 함수:**

- `generate()` - GPT API 호출 및 광고 카피 생성
- `parse_response()` - GPT 응답 파싱
- `validate_copy()` - 글자 수 검증, 품질 체크
- `apply_tone()` - 톤앤매너 적용

**산출:** `TextGenerator` 클래스, `PromptTemplateManager` 클래스

**포인트:** "GPT 기반 광고 카피 생성 및 통합 프롬프트 엔지니어링"

---

### ⑤ Infrastructure 담당

**영역:** `deployment/`, `tests/`, `backend/utils/`

**업무:** Docker, Cloud Run 배포, GPU 인스턴스 설정, GCS, CI/CD

**산출:** Dockerfile, CI/CD 파이프라인, 공통 유틸

**포인트:** "클라우드 인프라 구축 및 배포 자동화"

---

### Git 구조

```
프로젝트/
├─ frontend/             ← ①번
├─ backend/
│  ├─ api/               ← ②번
│  ├─ models/            ← ②번
│  ├─ services/          ← ②번
│  └─ utils/             ← ⑤번 (공유)
├─ models/
│  ├─ image_generation/  ← ③번
│  └─ text_generation/   ← ④번
├─ deployment/           ← ⑤번
└─ tests/                ← ⑤번
```

---

### 자동 모델 선택 로직

```
사용자 입력 분석:
- 이미지 없음 → t2i (컨셉 이미지)
- 이미지 있음 → ControlNet (제품 구조 유지, 스타일만 변경)
```