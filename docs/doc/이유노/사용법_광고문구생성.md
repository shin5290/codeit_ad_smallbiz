# 업종별 광고 문구 생성 기능 - 사용법 안내

## 📝 구현 완료 사항

### 1단계: 대화 히스토리 연동 ✅
- 최근 5개 대화를 자동으로 기억
- 사용자의 수정 요청사항을 누적 반영
- "딸기 넣어줘", "겨울 빼줘" 같은 점진적 수정 가능

### 2단계: 업종별 특화 프롬프트 ✅
- 30개 주요 업종 지원
- 각 업종의 특성에 맞는 키워드 자동 반영

---

## 🏢 지원하는 업종 (30개)

### 기본 서비스 (1-10)
| 업종 | 업종 코드 | 강조 키워드 |
|------|-----------|------------|
| 카페 | `cafe` | 휴식, 여유, 감성, 따뜻함 |
| 음식점 | `restaurant` | 맛, 오감, 경험, 만족감 |
| 베이커리 | `bakery` | 갓 구운, 신선함, 달콤함 |
| 헬스장 | `gym` | 변화, 도전, 성취, 건강 |
| 뷰티/미용 | `beauty` | 아름다움, 자신감, 케어 |
| 패션/의류 | `fashion` | 스타일, 트렌드, 개성 |
| 미용실 | `hair_salon` | 스타일 변신, 헤어 케어 |
| 네일샵 | `nail_salon` | 섬세함, 디테일, 감각 |
| 꽃집 | `flower_shop` | 감성, 특별한 날, 마음 전달 |
| 세탁소 | `laundry` | 깨끗함, 편리함, 신뢰 |

### 생활 서비스 (11-20)
| 업종 | 업종 코드 | 강조 키워드 |
|------|-----------|------------|
| 편의점 | `convenience_store` | 편리함, 24시간, 빠른 해결 |
| 약국 | `pharmacy` | 건강, 전문 상담, 신뢰 |
| 병원/의원 | `hospital` | 건강, 전문 진료, 안심 |
| 치과 | `dental_clinic` | 건강한 미소, 무통 치료 |
| 애완동물샵 | `pet_shop` | 반려동물, 사랑, 케어 |
| 서점 | `bookstore` | 지식, 여유, 새로운 세계 |
| 문구점 | `stationery` | 창의성, 학습, 설렘 |
| PC방 | `pc_cafe` | 게임, 몰입, 최신 시설 |
| 노래방 | `karaoke` | 스트레스 해소, 즐거움 |
| 학원 | `academy` | 성적 향상, 전문 강사 |

### 전문 서비스 (21-30)
| 업종 | 업종 코드 | 강조 키워드 |
|------|-----------|------------|
| 요가/필라테스 | `yoga` | 균형, 유연성, 힐링 |
| 마사지/스파 | `massage` | 힐링, 릴랙스, 피로 회복 |
| 부동산 | `real_estate` | 신뢰, 전문성, 최적의 선택 |
| 세차장 | `car_wash` | 깨끗함, 광택, 새차 같은 느낌 |
| 자동차정비 | `car_repair` | 안전, 전문 기술, 신뢰 |
| 안경점 | `optical_shop` | 시력 보호, 스타일, 전문 검안 |
| 주얼리/액세서리 | `jewelry` | 특별함, 빛나는 순간, 프리미엄 |
| 가구점 | `furniture` | 편안함, 인테리어, 품질 |
| 인테리어 | `interior` | 공간 변신, 맞춤 디자인 |
| 청소/이사 | `cleaning_service` | 깨끗함, 편리함, 새로운 시작 |

---

## 🚀 테스트 방법

### 방법 1: 독립 테스트 스크립트 (추천)

프로젝트 루트에서 실행:

```bash
python test_text_generation.py
```

**테스트 항목**:
1. ✅ 기본 광고 문구 생성
2. ✅ 대화 맥락 반영 (누적 수정)
3. ✅ 업종별 문구 차이
4. ✅ 톤 앤 매너 비교

---

### 방법 2: 실제 서버에서 테스트

#### 1. 서버 실행
```bash
# .env 파일 확인 (OPENAI_API_KEY 필수)
python main.py
```

#### 2. 브라우저에서 접속
```
http://localhost:8000
```

#### 3. 테스트 시나리오

**시나리오 A: 카페 광고 점진적 개선**
```
1️⃣ "카페 딸기라떼 광고 문구 만들어줘"
   → AI: "달콤한 봄날의 초대"

2️⃣ "딸기라는 단어를 꼭 넣어줘"
   → AI: "딸기가 전하는 달콤한 봄날"
   (✅ 이전 대화 기억!)

3️⃣ "봄날 대신 겨울로 바꿔줘"
   → AI: "딸기가 전하는 달콤한 겨울"
   (✅ 누적 수정 반영!)
```

**시나리오 B: 업종 자동 감지**
```
"헬스장 신규 회원 모집"
→ Intent 분석이 industry="gym" 자동 감지
→ "새로운 나를 만나는 시간" (gym 특화 문구)
```

---

## 💻 개발자용: 코드 직접 호출

### TextGenerator 직접 사용

```python
from src.generation.text_generation.text_generator import TextGenerator

generator = TextGenerator()

# 기본 사용
result = generator.generate_ad_copy(
    user_input="카페 신메뉴 홍보",
    tone="warm",           # warm/professional/friendly/energetic
    max_length=25,         # 최대 글자 수
    industry="cafe"        # 업종 (선택)
)
print(result)  # "따뜻한 오후의 여유"
```

### 대화 히스토리 포함

```python
# 대화 히스토리 구성
chat_history = [
    {"role": "user", "content": "카페 딸기라떼 홍보"},
    {"role": "assistant", "content": "달콤한 봄날의 초대"},
    {"role": "user", "content": "딸기 단어 넣어줘"}
]

# 대화 맥락 반영하여 생성
result = generator.generate_ad_copy(
    user_input="딸기 단어 넣어줘",
    tone="warm",
    max_length=25,
    chat_history=chat_history,  # 대화 히스토리 전달
    industry="cafe"
)
print(result)  # "딸기가 전하는 달콤한 봄날"
```

---

## 🔧 백엔드 통합 (services.py)

**실제 서비스에서는 자동으로 처리됩니다:**

```python
# services.py의 generate_contents()에서 자동 처리

1. Intent 분석 → industry 자동 감지
   사용자: "카페 광고 만들어줘"
   → Intent: industry="cafe" 자동 추출

2. 대화 히스토리 자동 조회
   → DB에서 최근 10개 대화 가져오기

3. TextGenerator 호출
   text_gen.generate_ad_copy(
       user_input=input_text,
       tone=text_tone or "warm",
       max_length=safe_max_length,
       chat_history=chat_history,  # ← 자동 전달
       industry=industry,           # ← 자동 전달
   )

4. 결과 자동 저장
   → GenerationHistory에 저장
   → ChatHistory에 저장
```

---

## 📊 예상 결과

### 같은 입력, 다른 업종

**입력**: "신메뉴 출시"

| 업종 | 생성 문구 예시 |
|------|---------------|
| cafe | "오후의 여유가 담긴 새로운 맛" |
| restaurant | "오감을 깨우는 특별한 한 접시" |
| gym | "새로운 도전, 새로운 나" |
| bakery | "갓 구운 행복의 향기" |
| pharmacy | "건강한 하루를 위한 첫걸음" |
| bookstore | "새로운 세계로의 초대" |
| yoga | "균형 잡힌 삶의 시작" |
| massage | "피로를 씻어내는 힐링 타임" |

### 같은 입력, 다른 톤

**입력**: "헬스장 신규 회원"

| 톤 | 생성 문구 예시 |
|------|---------------|
| warm | "당신의 변화를 응원합니다" |
| professional | "전문 트레이너와 함께하는 성공적인 시작" |
| friendly | "함께 시작해요, 건강한 라이프" |
| energetic | "지금 바로 시작하세요, 새로운 나!" |

---

## 🐛 문제 해결

### 1. OPENAI_API_KEY 오류
```bash
ValueError: OPENAI_API_KEY가 설정되지 않았습니다.
```

**해결**: 프로젝트 루트에 `.env` 파일 생성
```env
OPENAI_API_KEY=sk-proj-xxxxxxxxxxxxx
```

### 2. 모듈 import 오류
```bash
ModuleNotFoundError: No module named 'openai'
```

**해결**: OpenAI 패키지 설치
```bash
pip install openai python-dotenv
```

### 3. 대화 히스토리가 반영 안됨
- `chat_history` 파라미터 확인
- 리스트 형식: `[{"role": "user", "content": "..."}]`

---

## 📈 다음 단계

### 이미 완료 ✅
- [x] 대화 히스토리 연동
- [x] 10개 업종 특화 프롬프트
- [x] services.py 자동 통합

### 추가 가능 기능 💡
- [ ] 더 많은 업종 추가 (현재 30개 → 50개 이상)
- [ ] industries.yaml 통합 (247개 전체 업종)
- [ ] 대화 요약 (10개 이상 시 자동 요약)
- [ ] 다국어 지원 (영어, 일본어 등)
- [ ] A/B 테스트 (여러 버전 생성)

---

## 📞 문의

- 구현: 배현석님 (텍스트 생성 담당)
- 백엔드 통합: 진수경님
- 이슈 발견 시: 팀 회의록 또는 협업일지에 기록

---

**작성일**: 2026-01-22 (업데이트)
**버전**: 3.0 (30개 업종 지원)
