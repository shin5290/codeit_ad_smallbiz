# 배현석님 체크리스트
## 텍스트 및 프롬프트 생성 (GPT API)

**담당 범위**: 
- OpenAI GPT API 연동
- 이미지 생성용 프롬프트 생성
- 광고 문구 생성
- API 비용 최적화

**프로젝트 기간**: 2025-12-29 ~ 2026-01-27

---

## 📅 1단계 (MVP): ~ 2026-01-15

### 🗓 1주차 (12/29 ~ 1/4): GPT API 연동

#### Day 1-2 (12/29-12/30): 환경 설정

**OpenAI API 키 저장(.env)**
- [ ] .env 파일에 저장
  ```bash
  OPENAI_API_KEY=sk-...
  ```

**의존성 설치**
- [ ] OpenAI Python 패키지 설치
  ```bash
  pip install openai==1.6.1
  ```
- [ ] 설치 확인
  ```python
  import openai
  print(openai.__version__)
  ```

**API 연결 테스트**
- [ ] 기본 API 호출 테스트
  ```python
  from openai import OpenAI
  # api_key는 .env에 저장된 OPENAI_API_KEY를 활용하게 해야 함
  client = OpenAI(api_key="sk-...")
  
  response = client.chat.completions.create(
      model="gpt-4o-mini",
      messages=[{"role": "user", "content": "Hello!"}]
  )
  print(response.choices[0].message.content)
  ```

#### Day 3-5 (12/31-1/2): TextGenerator 클래스

**파일 생성**
- [ ] 파일 생성: `src/generation/text_generation/text_generator.py`
- [ ] Import 구문
  ```python
  from openai import OpenAI
  import logging
  
  logger = logging.getLogger(__name__)
  ```

**TextGenerator 클래스 기본 구조**
- [ ] 클래스 정의
  ```python
  class TextGenerator:
      def __init__(self, api_key):
          self.client = OpenAI(api_key=api_key)
  ```

**generate_ad_copy() 함수**
- [ ] 시스템 프롬프트 작성
  ```python
  system_prompt = """당신은 소상공인을 위한 광고 카피라이터입니다.
  따뜻하고 감성적인 톤으로 짧고 임팩트 있는 광고 문구를 만들어주세요.
  
  규칙:
  1. 20자 이내 (한글 기준)
  2. 이모지 사용 금지
  3. 간결하고 기억에 남는 표현
  4. 행동 유도 또는 감정 자극
  
  예시:
  - "따뜻한 겨울, 새로운 맛과 함께"
  - "지금 바로, 특별한 순간을"
  - "당신만의 스타일, 여기서 시작"
  """
  ```
- [ ] 함수 구현
  ```python
  def generate_ad_copy(self, user_input, tone="warm"):
      tone_prompts = {
          "warm": "따뜻하고 감성적인 톤으로",
          "professional": "전문적이고 신뢰감 있는 톤으로",
          "friendly": "친근하고 활발한 톤으로",
          "energetic": "역동적이고 강렬한 톤으로"
      }
      
      user_prompt = f"""다음 내용에 맞는 광고 문구를 만들어주세요:
      
      {user_input}
      
      광고 문구 (20자 이내):"""
      
      try:
          response = self.client.chat.completions.create(
              model="gpt-4o-mini",
              messages=[
                  {"role": "system", "content": system_prompt},
                  {"role": "user", "content": user_prompt}
              ],
              temperature=0.8,
              max_tokens=50
          )
          
          ad_copy = response.choices[0].message.content.strip()
          
          # 길이 제한
          if len(ad_copy) > 30:
              ad_copy = ad_copy[:27] + "..."
          
          logger.info(f"Ad copy generated: {ad_copy}")
          
          return ad_copy
          
      except Exception as e:
          logger.error(f"GPT API error: {e}")
          return "특별한 순간을 위한 선택"  # 폴백
  ```

**테스트**
- [ ] 다양한 입력 테스트
  ```python
  gen = TextGenerator(api_key="sk-...")
  
  # 카페
  copy1 = gen.generate_ad_copy("카페 신메뉴 홍보, 겨울 시즌")
  print(f"카페: {copy1}")
  
  # 헬스장
  copy2 = gen.generate_ad_copy("헬스장 회원 모집, 신년 특가")
  print(f"헬스장: {copy2}")
  
  # 꽃집
  copy3 = gen.generate_ad_copy("꽃집 봄 이벤트, 장미 할인")
  print(f"꽃집: {copy3}")
  ```

#### Day 6-7 (1/3-1/4): 응답 품질 확인

**응답 품질 테스트**
- [ ] 20자 이내 제약 확인
- [ ] 톤 적합성 확인 (warm, professional 등)
- [ ] 이모지 포함 여부 확인
- [ ] 특수문자 처리 확인

**에러 처리**
- [ ] API 호출 실패 시 폴백
- [ ] 타임아웃 처리 (10초)
- [ ] 로그 기록

**✅ 1주차 마일스톤**: GPT API로 광고 문구 생성 성공

---

### 🗓 2주차 (1/5 ~ 1/11): 프롬프트 템플릿 관리

#### Day 8-10 (1/5-1/7): PromptTemplateManager 클래스

**파일 생성**
- [ ] 파일 생성: `src/generation/text_generation/prompt_manager.py`
- [ ] Import 구문
  ```python
  from openai import OpenAI
  import logging
  
  logger = logging.getLogger(__name__)
  ```

**PromptTemplateManager 클래스**
- [ ] 클래스 정의
  ```python
  class PromptTemplateManager:
      def __init__(self, api_key=None):
          from src.utils.config import settings
          self.client = OpenAI(api_key=api_key or settings.OPENAI_API_KEY)
  ```

**generate_image_prompt() 함수**
- [ ] 시스템 프롬프트 작성
  ```python
  system_prompt = """당신은 이미지 생성 AI를 위한 프롬프트 전문가입니다.
  사용자의 요청을 Stable Diffusion에 적합한 영문 태그로 변환하세요.
  
  규칙:
  1. 영문 태그만 사용 (쉼표로 구분)
  2. 구체적인 시각 요소 포함
  3. 분위기와 스타일 강조
  4. 업종 관련 키워드 포함
  
  예시:
  입력: "카페 신메뉴 홍보, 따뜻한 느낌"
  출력: cafe interior, new menu board, warm lighting, cozy atmosphere, latte art, coffee beans, winter season, promotional poster, high quality, detailed"""
  ```
- [ ] 함수 구현
  ```python
  def generate_image_prompt(self, user_input):
      user_prompt = f"""다음 요청을 이미지 생성 태그로 변환해주세요:
      
      입력: {user_input}
      
      출력 (태그만):"""
      
      try:
          response = self.client.chat.completions.create(
              model="gpt-4o-mini",
              messages=[
                  {"role": "system", "content": system_prompt},
                  {"role": "user", "content": user_prompt}
              ],
              temperature=0.7,
              max_tokens=150
          )
          
          tags = response.choices[0].message.content.strip()
          
          # 품질 태그 추가
          tags += ", high quality, detailed, professional"
          
          logger.info(f"Image prompt generated: {tags[:50]}...")
          
          return tags
          
      except Exception as e:
          logger.error(f"GPT API error: {e}")
          # 폴백: 기본 태그 반환
          return "promotional image, high quality, professional"
  ```

**테스트**
- [ ] 다양한 업종 테스트
  ```python
  pm = PromptTemplateManager(api_key="sk-...")
  
  # 카페
  prompt1 = pm.generate_image_prompt("카페 신메뉴 홍보, 따뜻한 느낌")
  print(f"카페 프롬프트: {prompt1}")
  
  # 헬스장
  prompt2 = pm.generate_image_prompt("헬스장 회원 모집, 강렬한 이미지")
  print(f"헬스장 프롬프트: {prompt2}")
  
  # 꽃집
  prompt3 = pm.generate_image_prompt("꽃집 봄 이벤트, 화사한 분위기")
  print(f"꽃집 프롬프트: {prompt3}")
  ```

#### Day 11-12 (1/8-1/9): 통합 테스트

**프롬프트 생성 → 이미지 생성 테스트 (3번 담당자 협업)**
- [ ] PromptTemplateManager로 프롬프트 생성
- [ ] UnifiedImageGenerator에 프롬프트 전달
- [ ] 생성된 이미지 품질 확인
- [ ] 프롬프트와 이미지 일치도 확인

**텍스트 + 이미지 통합 테스트**
- [ ] 광고 문구 생성
- [ ] 이미지 프롬프트 생성
- [ ] 이미지 생성 (텍스트 오버레이 포함)
- [ ] 전체 결과 확인

#### Day 13-14 (1/10-1/11): 에러 처리

**API 호출 실패 처리**
- [ ] 재시도 로직 (최대 3회)
  ```python
  def _call_api_with_retry(self, messages, max_retries=3):
      for attempt in range(max_retries):
          try:
              response = self.client.chat.completions.create(
                  model="gpt-4o-mini",
                  messages=messages,
                  temperature=0.7,
                  max_tokens=150
              )
              return response
          except Exception as e:
              logger.warning(f"API call failed (attempt {attempt+1}/{max_retries}): {e}")
              if attempt == max_retries - 1:
                  raise
              time.sleep(2 ** attempt)  # 지수 백오프
  ```
- [ ] 타임아웃 10초
- [ ] 폴백 응답

**비용 모니터링**
- [ ] API 호출 횟수 로그
  ```python
  logger.info(f"GPT API call count: {self.call_count}")
  ```
- [ ] 프롬프트 길이 제한
  ```python
  if len(user_input) > 500:
      user_input = user_input[:500]
  ```

**✅ 2주차 마일스톤**: 프롬프트 생성 → 이미지 생성 전체 플로우

---

### 🗓 3주차 (1/12 ~ 1/15): 품질 개선

#### Day 15-17 (1/12-1/14): 응답 후처리

**길이 제한**
- [ ] 광고 문구 30자 초과 시 자르기
  ```python
  if len(ad_copy) > 30:
      ad_copy = ad_copy[:27] + "..."
  ```
- [ ] 프롬프트 150토큰 제한

**특수문자 제거**
- [ ] 이모지 제거
  ```python
  import re
  ad_copy = re.sub(r'[\U00010000-\U0010ffff]', '', ad_copy)
  ```
- [ ] 불필요한 기호 제거 (*, #, @ 등)
  ```python
  ad_copy = re.sub(r'[*#@]', '', ad_copy)
  ```

**품질 검증**
- [ ] 빈 응답 처리
  ```python
  if not ad_copy.strip():
      ad_copy = "특별한 순간을 위한 선택"
  ```
- [ ] 부적절한 내용 필터링 (선택)

#### Day 18 (1/15): 최종 테스트

**다양한 업종 테스트**
- [ ] 카페
- [ ] 식당
- [ ] 헬스장
- [ ] 꽃집
- [ ] 미용실
- [ ] 의류 매장
- [ ] 서점
- [ ] 베이커리

**톤별 테스트**
- [ ] warm (따뜻한)
- [ ] professional (전문적인)
- [ ] friendly (친근한)
- [ ] energetic (역동적인)

**✅ 3주차 마일스톤**: 프롬프트 생성 안정화

---

## 📅 2단계 (개선): 2026-01-16 ~ 27

### 🗓 4주차 (1/16 ~ 1/22): 고급 기능

#### Day 19-21 (1/16-1/18): 키워드 추출

**extract_keywords() 함수**
- [ ] 함수 작성
  ```python
  def extract_keywords(self, text):
      system_prompt = """텍스트에서 핵심 키워드를 추출하세요.
      결과는 쉼표로 구분된 키워드 리스트로 반환하세요."""
      
      user_prompt = f"다음 텍스트에서 키워드 추출:\n{text}"
      
      response = self.client.chat.completions.create(
          model="gpt-4o-mini",
          messages=[
              {"role": "system", "content": system_prompt},
              {"role": "user", "content": user_prompt}
          ],
          temperature=0.5,
          max_tokens=100
      )
      
      keywords_str = response.choices[0].message.content.strip()
      keywords = [k.strip() for k in keywords_str.split(',')]
      
      return keywords
  ```
- [ ] 테스트

**톤별 프롬프트 개선**
- [ ] tone 파라미터에 따른 시스템 프롬프트 변경
- [ ] Few-shot 예시 추가
  ```python
  few_shot_examples = {
      "warm": [
          {"input": "카페 신메뉴", "output": "따뜻한 겨울, 새로운 맛"},
          {"input": "베이커리 할인", "output": "오늘만의 특별한 선택"}
      ],
      ...
  }
  ```

#### Day 22-24 (1/19-1/21): API 재시도 로직

**재시도 로직 개선**
- [ ] 지수 백오프 적용
- [ ] 에러 타입별 처리
  - [ ] RateLimitError → 긴 대기
  - [ ] APIError → 재시도
  - [ ] InvalidRequestError → 즉시 실패

**API 비용 최적화**
- [ ] 프롬프트 길이 최소화
- [ ] 캐싱 (선택)
  ```python
  @lru_cache(maxsize=100)
  def generate_ad_copy_cached(self, user_input, tone):
      return self.generate_ad_copy(user_input, tone)
  ```
- [ ] 호출 횟수 모니터링

### 🗓 5주차 (1/23 ~ 1/27): 마무리

#### Day 25-27 (1/23-1/25): 품질 개선

**Few-shot 예시 추가**
- [ ] 각 톤별 5개 예시 추가
- [ ] 업종별 예시 추가

**응답 품질 검증**
- [ ] 길이 확인 (10-30자)
- [ ] 한글 비율 확인 (80% 이상)
- [ ] 의미 있는 문장 확인

#### Day 28-30 (1/26-1/27): 문서화

**사용 가이드 작성**
- [ ] API 키 설정 방법
- [ ] 함수별 사용 예시
- [ ] 에러 처리 방법

**✅ 최종 완료**: 텍스트 및 프롬프트 생성 모듈 완성

---

## 📊 진행 상황 추적

### 1단계 (MVP) 요약
- [ ] GPT API 연동
- [ ] TextGenerator 클래스
- [ ] PromptTemplateManager 클래스
- [ ] 에러 처리 및 재시도

### 2단계 (개선) 요약
- [ ] 키워드 추출 기능
- [ ] 톤별 프롬프트 개선
- [ ] API 비용 최적화
- [ ] 품질 검증 강화

---

## 🤝 협업 포인트

### 진수경님과의 협업
- [ ] services.create_advertisement()에서 호출
- [ ] 반환값 형식 확인

### 이현석님과의 협업
- [ ] 생성된 프롬프트로 이미지 생성
- [ ] 광고 문구를 텍스트 오버레이로 사용

---

## 📝 참고 사항

### OpenAI API 사용량 확인
https://platform.openai.com/usage

### gpt-4o-mini 가격 (2024년 기준)
- Input: $0.15 / 1M tokens
- Output: $0.6 / 1M tokens

### 예상 비용 (1회 생성)
- 프롬프트 생성: ~300 tokens → $0.0003
- 광고 문구 생성: ~200 tokens → $0.0002
- 총: ~$0.0005 / 1회

---

**작성일**: 2026-01-02  
**담당자**: 배현석 (텍스트 및 프롬프트 생성)  
**최종 수정**: 2026-01-05
