# 진수경님 체크리스트
## 백엔드 비즈니스 로직 (services.py, db_processor.py, schemas.py)

**담당 범위**: 
- DB 설계 및 CRUD (PostgreSQL)
- 비즈니스 로직 (services.py)
- 데이터 스키마 (schemas.py)
- AI 모델 호출 조율

**프로젝트 기간**: 2025-12-29 ~ 2026-01-27

---

## 📅 1단계 (MVP): ~ 2026-01-15

### 🗓 1주차 (12/29 ~ 1/4): DB 설정 및 기본 CRUD

#### Day 1-2 (12/29-12/30): PostgreSQL 설정 (GCP VM)

**PostgreSQL 설치**
- [ ] GCP VM 접속
- [ ] PostgreSQL 설치
  ```bash
  sudo apt-get update
  sudo apt-get install postgresql postgresql-contrib
  ```
- [ ] PostgreSQL 서비스 상태 확인
  ```bash
  sudo systemctl status postgresql
  ```

**데이터베이스 및 사용자 생성**
- [ ] PostgreSQL 접속
  ```bash
  sudo -u postgres psql
  ```
- [ ] 데이터베이스 생성
  ```sql
  CREATE DATABASE ad_generator;
  ```
- [ ] 사용자 생성 및 권한 부여
  ```sql
  CREATE USER ad_user WITH PASSWORD 'your_secure_password';
  GRANT ALL PRIVILEGES ON DATABASE ad_generator TO ad_user;
  ```
- [ ] 연결 테스트
  ```bash
  psql -U ad_user -d ad_generator -h localhost
  ```

**db_processor.py 기본 구조**
- [ ] 파일 생성: `src/backend/db_processor.py`
- [ ] DBProcessor 클래스 생성
- [ ] `__init__` 메서드
  ```python
  def __init__(self):
      self.conn_params = {
          "host": "localhost",
          "port": 5432,
          "database": "ad_generator",
          "user": "ad_user",
          "password": settings.DB_PASSWORD
      }
  ```
- [ ] `get_connection()` 메서드
  ```python
  def get_connection(self):
      return psycopg2.connect(**self.conn_params)
  ```
- [ ] 연결 테스트
  ```python
  db = DBProcessor()
  conn = db.get_connection()
  print("Connection successful!")
  conn.close()
  ```

#### Day 3-5 (12/31-1/2): 테이블 스키마 생성

**user 테이블**
- [ ] SQL 작성
  ```sql
  CREATE TABLE "user" (
      user_id SERIAL PRIMARY KEY,
      login_id VARCHAR(50) UNIQUE NOT NULL,
      login_pw VARCHAR(255) NOT NULL,
      created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
  );
  ```
- [ ] 인덱스 생성
  ```sql
  CREATE INDEX idx_user_login_id ON "user"(login_id);
  ```
- [ ] 테이블 생성 실행
- [ ] 테이블 확인
  ```sql
  \dt
  \d "user"
  ```

**generation_history 테이블**
- [ ] SQL 작성
  ```sql
  CREATE TABLE generation_history (
      id SERIAL PRIMARY KEY,
      user_id INTEGER REFERENCES "user"(user_id) ON DELETE SET NULL,
      input_text TEXT NOT NULL,
      input_image_hash VARCHAR(64),
      content_type VARCHAR(10) CHECK (content_type IN ('image', 'text', 'both')),
      output_url TEXT,
      generation_method VARCHAR(20) CHECK (generation_method IN ('t2i', 'controlnet')),
      style TEXT,
      industry VARCHAR(50),
      seed INTEGER,
      aspect_ratio VARCHAR(10) CHECK (aspect_ratio IN ('1:1', '4:3', '3:4')),
      created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
  );
  ```
- [ ] 인덱스 생성
  ```sql
  CREATE INDEX idx_gen_user_id ON generation_history(user_id);
  CREATE INDEX idx_gen_created_at ON generation_history(created_at DESC);
  ```

**chat_history 테이블**
- [ ] SQL 작성
  ```sql
  CREATE TABLE chat_history (
      id SERIAL PRIMARY KEY,
      user_id INTEGER REFERENCES "user"(user_id) ON DELETE SET NULL,
      session_id VARCHAR(64) NOT NULL,
      message_id INTEGER NOT NULL,
      role VARCHAR(10) CHECK (role IN ('user', 'assistant')) NOT NULL,
      content TEXT NOT NULL,
      input_image_hash VARCHAR(64),
      gen_image_url TEXT,
      created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
  );
  ```
- [ ] 인덱스 생성
  ```sql
  CREATE INDEX idx_chat_user_session ON chat_history(user_id, session_id);
  CREATE INDEX idx_chat_session ON chat_history(session_id);
  ```

**image_matching 테이블**
- [ ] SQL 작성
  ```sql
  CREATE TABLE image_matching (
      id SERIAL PRIMARY KEY,
      file_hash VARCHAR(64) UNIQUE NOT NULL,
      file_directory TEXT NOT NULL,
      file_type VARCHAR(10) CHECK (file_type IN ('input', 'generated')) NOT NULL,
      created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
  );
  ```
- [ ] 인덱스 생성
  ```sql
  CREATE INDEX idx_img_file_hash ON image_matching(file_hash);
  ```

**테이블 생성 스크립트 작성**
- [ ] `create_tables.sql` 파일 생성
- [ ] 모든 테이블 생성 SQL 통합
- [ ] 스크립트 실행
  ```bash
  psql -U ad_user -d ad_generator -f create_tables.sql
  ```

#### Day 6-7 (1/3-1/4): 기본 CRUD 함수

**create_user() 함수**
- [ ] 메서드 작성
  ```python
  def create_user(self, login_id, hashed_pw):
      with self.get_connection() as conn:
          with conn.cursor() as cur:
              cur.execute(
                  'INSERT INTO "user" (login_id, login_pw) VALUES (%s, %s) RETURNING user_id',
                  (login_id, hashed_pw)
              )
              user_id = cur.fetchone()[0]
              conn.commit()
      return user_id
  ```
- [ ] 테스트
  ```python
  import bcrypt
  hashed = bcrypt.hashpw('test123'.encode(), bcrypt.gensalt())
  user_id = db.create_user('testuser', hashed.decode())
  print(f"Created user: {user_id}")
  ```

**get_user_by_login_id() 함수**
- [ ] 메서드 작성
  ```python
  def get_user_by_login_id(self, login_id):
      with self.get_connection() as conn:
          with conn.cursor(cursor_factory=RealDictCursor) as cur:
              cur.execute(
                  'SELECT user_id, login_pw FROM "user" WHERE login_id = %s',
                  (login_id,)
              )
              result = cur.fetchone()
      return dict(result) if result else None
  ```

**check_duplicate_id() 함수**
- [ ] 메서드 작성
  ```python
  def check_duplicate_id(self, login_id):
      with self.get_connection() as conn:
          with conn.cursor() as cur:
              cur.execute('SELECT COUNT(*) FROM "user" WHERE login_id = %s', (login_id,))
              count = cur.fetchone()[0]
      return count > 0
  ```

**save_generation_history() 함수**
- [ ] 메서드 작성
  ```python
  def save_generation_history(self, data):
      with self.get_connection() as conn:
          with conn.cursor() as cur:
              cur.execute('''
                  INSERT INTO generation_history (
                      user_id, input_text, content_type, output_url,
                      generation_method, style, seed, aspect_ratio
                  ) VALUES (%s, %s, %s, %s, %s, %s, %s, %s)
                  RETURNING id
              ''', (
                  data["user_id"], data["input_text"], data["content_type"],
                  data["output_url"], data["generation_method"], data["style"],
                  data["seed"], data["aspect_ratio"]
              ))
              history_id = cur.fetchone()[0]
              conn.commit()
      return history_id
  ```

**save_chat_message() 함수**
- [ ] 메서드 작성
  ```python
  def save_chat_message(self, data):
      with self.get_connection() as conn:
          with conn.cursor() as cur:
              cur.execute('''
                  INSERT INTO chat_history (
                      user_id, session_id, message_id, role, content,
                      input_image_hash, gen_image_url
                  ) VALUES (%s, %s, %s, %s, %s, %s, %s)
              ''', (
                  data["user_id"], data["session_id"], data["message_id"],
                  data["role"], data["content"],
                  data.get("input_image_hash"), data.get("gen_image_url")
              ))
              conn.commit()
  ```

**save_image_matching() 함수**
- [ ] 메서드 작성 (5번 담당자와 협업)
  ```python
  def save_image_matching(self, file_hash, file_directory, file_type):
      with self.get_connection() as conn:
          with conn.cursor() as cur:
              cur.execute('''
                  INSERT INTO image_matching (file_hash, file_directory, file_type)
                  VALUES (%s, %s, %s)
                  ON CONFLICT (file_hash) DO NOTHING
              ''', (file_hash, file_directory, file_type))
              conn.commit()
  ```

**get_generation_history() 함수**
- [ ] 메서드 작성
  ```python
  def get_generation_history(self, user_id, limit=20):
      with self.get_connection() as conn:
          with conn.cursor(cursor_factory=RealDictCursor) as cur:
              cur.execute('''
                  SELECT id, output_url, created_at, style, aspect_ratio
                  FROM generation_history
                  WHERE user_id = %s
                  ORDER BY created_at DESC
                  LIMIT %s
              ''', (user_id, limit))
              results = cur.fetchall()
      return [dict(row) for row in results]
  ```

**CRUD 함수 테스트**
- [ ] 각 함수별 단위 테스트
- [ ] 트랜잭션 롤백 테스트
- [ ] 에러 처리 테스트

**✅ 1주차 마일스톤**: DB 테이블 생성 완료, CRUD 함수 테스트 완료

---

### 🗓 2주차 (1/5 ~ 1/11): 비즈니스 로직 통합

#### Day 8-10 (1/5-1/7): services.py 워크플로우

**services.py 파일 생성**
- [ ] 파일 생성: `src/backend/services.py`
- [ ] Import 구문
  ```python
  from src.generation.image_generation.unified_generator import UnifiedImageGenerator
  from src.generation.text_generation.prompt_manager import PromptTemplateManager
  from src.generation.text_generation.text_generator import TextGenerator
  from src.backend.db_processor import DBProcessor
  from src.utils.storage import save_image
  from src.utils.config import settings
  import logging
  import uuid
  ```

**전역 객체 초기화**
- [ ] AI 모델 인스턴스 생성
  ```python
  image_generator = UnifiedImageGenerator(model_type="sdxl")
  prompt_manager = PromptTemplateManager()
  text_generator = TextGenerator(api_key=settings.OPENAI_API_KEY)
  db = DBProcessor()
  ```
- [ ] 로거 설정
  ```python
  logger = logging.getLogger(__name__)
  ```

**create_advertisement() 함수 - Part 1**
- [ ] 함수 시그니처
  ```python
  def create_advertisement(task_id, user_id, input_text, aspect_ratio, task_storage):
  ```
- [ ] try-except 블록 설정
- [ ] Task 상태 초기화
  ```python
  task_storage[task_id]["status"] = "processing"
  task_storage[task_id]["progress"] = 10
  ```

**create_advertisement() 함수 - Part 2: AI 호출**
- [ ] 프롬프트 생성 (3번, 4번 담당자 협업)
  ```python
  image_prompt = prompt_manager.generate_image_prompt(input_text)
  task_storage[task_id]["progress"] = 30
  ```
- [ ] 광고 문구 생성
  ```python
  ad_copy = text_generator.generate_ad_copy(input_text)
  task_storage[task_id]["progress"] = 40
  ```
- [ ] 이미지 생성
  ```python
  image_result = image_generator.generate(
      prompt=image_prompt,
      aspect_ratio=aspect_ratio,
      ad_copy=ad_copy
  )
  task_storage[task_id]["progress"] = 70
  ```

**create_advertisement() 함수 - Part 3: 파일 저장**
- [ ] 파일 저장 (5번 담당자 협업)
  ```python
  file_info = save_image(
      image_path=image_result["image_path"],
      user_id=user_id
  )
  task_storage[task_id]["progress"] = 80
  ```

**create_advertisement() 함수 - Part 4: DB 저장**
- [ ] generation_history 저장
  ```python
  db.save_generation_history({
      "user_id": user_id,
      "input_text": input_text,
      "content_type": "image",
      "output_url": file_info["url"],
      "generation_method": "t2i",
      "style": image_result["metadata"]["style"],
      "seed": image_result["metadata"]["seed"],
      "aspect_ratio": aspect_ratio
  })
  ```
- [ ] chat_history 저장 (사용자 메시지)
  ```python
  session_id = str(uuid.uuid4())
  db.save_chat_message({
      "user_id": user_id,
      "session_id": session_id,
      "message_id": 1,
      "role": "user",
      "content": input_text
  })
  ```
- [ ] chat_history 저장 (AI 응답)
  ```python
  db.save_chat_message({
      "user_id": user_id,
      "session_id": session_id,
      "message_id": 2,
      "role": "assistant",
      "content": ad_copy,
      "gen_image_url": file_info["url"]
  })
  ```

**create_advertisement() 함수 - Part 5: 완료 처리**
- [ ] Task 상태 업데이트
  ```python
  task_storage[task_id]["progress"] = 100
  task_storage[task_id]["status"] = "completed"
  task_storage[task_id]["result"] = {
      "image_url": file_info["url"],
      "ad_copy": ad_copy
  }
  ```
- [ ] 로그 기록
  ```python
  logger.info(f"Task {task_id}: 완료")
  ```

**에러 처리**
- [ ] except 블록 구현
  ```python
  except Exception as e:
      logger.error(f"Task {task_id} 실패: {str(e)}", exc_info=True)
      task_storage[task_id]["status"] = "failed"
      task_storage[task_id]["error"] = str(e)
  ```
- [ ] 에러 종류별 처리
  - [ ] GPU 메모리 부족
  - [ ] GPT API 오류
  - [ ] DB 저장 실패

#### Day 11-12 (1/8-1/9): 인증 로직 준비

**schemas.py 파일 생성**
- [ ] 파일 생성: `src/backend/schemas.py`
- [ ] Pydantic import
  ```python
  from pydantic import BaseModel, Field
  from typing import Literal, Optional
  from datetime import datetime
  ```

**스키마 정의**
- [ ] GenerateRequest
  ```python
  class GenerateRequest(BaseModel):
      user_id: Optional[int] = None
      input_text: str = Field(min_length=1, max_length=500)
      aspect_ratio: Literal["1:1", "4:3", "3:4"]
  ```
- [ ] TaskStatus
  ```python
  class TaskStatus(BaseModel):
      status: Literal["pending", "processing", "completed", "failed"]
      progress: int = Field(ge=0, le=100)
      result: Optional[dict] = None
      error: Optional[str] = None
  ```
- [ ] SignupRequest
  ```python
  class SignupRequest(BaseModel):
      login_id: str = Field(min_length=3, max_length=20, pattern="^[a-zA-Z0-9]+$")
      login_pw: str = Field(min_length=8, max_length=30)
  ```
- [ ] LoginRequest
  ```python
  class LoginRequest(BaseModel):
      login_id: str
      login_pw: str
  ```
- [ ] GenerationHistoryItem
  ```python
  class GenerationHistoryItem(BaseModel):
      id: int
      output_url: str
      created_at: datetime
      style: Optional[str]
      aspect_ratio: str
  ```

**register_user() 함수 (services.py)**
- [ ] 함수 작성
  ```python
  def register_user(login_id, login_pw):
      import bcrypt
      from src.utils.validators import validate_login_id, validate_password
      
      # 유효성 검증
      if not validate_login_id(login_id):
          raise ValueError("ID는 3-20자의 영문/숫자만 가능합니다.")
      
      if not validate_password(login_pw):
          raise ValueError("비밀번호는 최소 8자 이상이어야 합니다.")
      
      # 중복 확인
      if db.check_duplicate_id(login_id):
          raise ValueError("이미 사용 중인 아이디입니다.")
      
      # 비밀번호 해시
      hashed_pw = bcrypt.hashpw(login_pw.encode('utf-8'), bcrypt.gensalt())
      
      # DB 저장
      user_id = db.create_user(login_id, hashed_pw.decode('utf-8'))
      
      return user_id
  ```

**authenticate_user() 함수 (services.py)**
- [ ] 함수 작성
  ```python
  def authenticate_user(login_id, login_pw):
      import bcrypt
      import jwt
      from datetime import datetime, timedelta
      
      # 사용자 조회
      user = db.get_user_by_login_id(login_id)
      
      if not user:
          raise ValueError("아이디 또는 비밀번호가 일치하지 않습니다.")
      
      # 비밀번호 검증
      if not bcrypt.checkpw(login_pw.encode('utf-8'), user["login_pw"].encode('utf-8')):
          raise ValueError("아이디 또는 비밀번호가 일치하지 않습니다.")
      
      # JWT 토큰 생성
      payload = {
          "user_id": user["user_id"],
          "exp": datetime.utcnow() + timedelta(days=7)
      }
      token = jwt.encode(payload, settings.SECRET_KEY, algorithm="HS256")
      
      return {
          "user_id": user["user_id"],
          "session_token": token
      }
  ```

**get_generation_history() 함수 (services.py)**
- [ ] 함수 작성
  ```python
  def get_generation_history(user_id, limit=20):
      return db.get_generation_history(user_id, limit)
  ```

#### Day 13-14 (1/10-1/11): 통합 테스트

**Mock 데이터로 테스트**
- [ ] create_advertisement() 테스트
  ```python
  # Mock task_storage
  task_storage = {}
  task_id = "test-123"
  task_storage[task_id] = {"status": "pending", "progress": 0}
  
  # 실행
  create_advertisement(
      task_id=task_id,
      user_id=1,
      input_text="카페 신메뉴 홍보",
      aspect_ratio="1:1",
      task_storage=task_storage
  )
  
  # 확인
  print(task_storage[task_id])
  ```

**DB 저장 확인**
- [ ] PostgreSQL 접속
- [ ] generation_history 조회
  ```sql
  SELECT * FROM generation_history ORDER BY created_at DESC LIMIT 5;
  ```
- [ ] chat_history 조회
  ```sql
  SELECT * FROM chat_history ORDER BY created_at DESC LIMIT 10;
  ```
- [ ] image_matching 조회
  ```sql
  SELECT * FROM image_matching ORDER BY created_at DESC LIMIT 5;
  ```

**에러 케이스 테스트**
- [ ] 잘못된 입력 (빈 텍스트)
- [ ] 존재하지 않는 user_id
- [ ] DB 연결 실패 시나리오
- [ ] AI 모델 오류 시나리오

**✅ 2주차 마일스톤**: 광고 생성 워크플로우 완성, DB 저장 확인

---

### 🗓 3주차 (1/12 ~ 1/15): 인증 및 이력 조회

#### Day 15-17 (1/12-1/14): 인증 완성

**register_user() 테스트**
- [ ] 정상 케이스
  ```python
  user_id = register_user("testuser2", "password123")
  print(f"User created: {user_id}")
  ```
- [ ] 중복 ID 케이스
  ```python
  try:
      register_user("testuser2", "password123")
  except ValueError as e:
      print(f"Error: {e}")  # "이미 사용 중인 아이디입니다."
  ```
- [ ] 유효성 검증 실패 케이스
  ```python
  try:
      register_user("ab", "123")  # ID 너무 짧음, PW 너무 짧음
  except ValueError as e:
      print(f"Error: {e}")
  ```

**authenticate_user() 테스트**
- [ ] 정상 로그인
  ```python
  result = authenticate_user("testuser2", "password123")
  print(f"Token: {result['session_token']}")
  ```
- [ ] 잘못된 비밀번호
  ```python
  try:
      authenticate_user("testuser2", "wrongpassword")
  except ValueError as e:
      print(f"Error: {e}")
  ```
- [ ] 존재하지 않는 사용자
  ```python
  try:
      authenticate_user("nonexistent", "password123")
  except ValueError as e:
      print(f"Error: {e}")
  ```

**JWT 토큰 검증 테스트**
- [ ] 토큰 디코딩
  ```python
  import jwt
  token = result["session_token"]
  decoded = jwt.decode(token, settings.SECRET_KEY, algorithms=["HS256"])
  print(f"Decoded: {decoded}")
  ```
- [ ] 만료된 토큰 처리 (선택)

**routes.py와 통합 테스트 (1번 담당자 협업)**
- [ ] POST /auth/signup 엔드포인트 테스트
- [ ] POST /auth/login 엔드포인트 테스트
- [ ] 에러 응답 형식 확인

#### Day 18 (1/15): 이력 조회

**get_generation_history() 함수 검증**
- [ ] 사용자별 이력 조회
  ```python
  history = get_generation_history(user_id=1, limit=10)
  for item in history:
      print(f"ID: {item['id']}, URL: {item['output_url']}, Created: {item['created_at']}")
  ```
- [ ] 빈 이력 처리
  ```python
  history = get_generation_history(user_id=999)  # 존재하지 않는 사용자
  print(len(history))  # 0
  ```

**get_chat_sessions() 함수 작성 (2단계 준비)**
- [ ] 함수 작성 (db_processor.py)
  ```python
  def get_chat_sessions(self, user_id, limit=20):
      with self.get_connection() as conn:
          with conn.cursor(cursor_factory=RealDictCursor) as cur:
              cur.execute('''
                  SELECT DISTINCT ON (session_id)
                      session_id,
                      content as first_message,
                      created_at
                  FROM chat_history
                  WHERE user_id = %s AND role = 'user'
                  ORDER BY session_id, created_at ASC
                  LIMIT %s
              ''', (user_id, limit))
              results = cur.fetchall()
      return [dict(row) for row in results]
  ```

**get_chat_history() 함수 작성 (2단계 준비)**
- [ ] 함수 작성 (db_processor.py)
  ```python
  def get_chat_history(self, user_id, session_id):
      with self.get_connection() as conn:
          with conn.cursor(cursor_factory=RealDictCursor) as cur:
              cur.execute('''
                  SELECT role, content, gen_image_url, created_at
                  FROM chat_history
                  WHERE user_id = %s AND session_id = %s
                  ORDER BY message_id ASC
              ''', (user_id, session_id))
              results = cur.fetchall()
      return [dict(row) for row in results]
  ```

**성능 최적화**
- [ ] 인덱스 효과 확인
  ```sql
  EXPLAIN ANALYZE SELECT * FROM generation_history WHERE user_id = 1;
  ```
- [ ] 느린 쿼리 최적화

**✅ 3주차 마일스톤**: 인증 및 이력 조회 완성

---

## 📅 2단계 (개선): 2026-01-16 ~ 27

### 🗓 4주차 (1/16 ~ 1/22): 품질 향상

#### Day 19-21 (1/16-1/18): 채팅 세션 관리

**services.py 함수 추가**
- [ ] `get_chat_sessions()` 함수
  ```python
  def get_chat_sessions(user_id, limit=20):
      return db.get_chat_sessions(user_id, limit)
  ```
- [ ] `get_chat_history()` 함수
  ```python
  def get_chat_history(user_id, session_id):
      return db.get_chat_history(user_id, session_id)
  ```

**세션 지속성 로직**
- [ ] create_advertisement() 수정
  - [ ] session_id를 파라미터로 받기
  - [ ] 기존 세션에 메시지 추가
- [ ] 세션 생성/관리 로직 구현

**routes.py 엔드포인트 추가 (1번 담당자 협업)**
- [ ] GET /history/chat/sessions?user_id={id}
- [ ] GET /history/chat?user_id={id}&session_id={sid}

#### Day 22-24 (1/19-1/21): 성능 최적화

**DB 연결 풀 설정**
- [ ] psycopg2.pool 사용
  ```python
  from psycopg2 import pool
  
  class DBProcessor:
      def __init__(self):
          self.connection_pool = pool.SimpleConnectionPool(
              minconn=1,
              maxconn=20,
              **self.conn_params
          )
  ```
- [ ] get_connection() 수정
  ```python
  def get_connection(self):
      return self.connection_pool.getconn()
  ```
- [ ] putconn() 메서드 추가
  ```python
  def release_connection(self, conn):
      self.connection_pool.putconn(conn)
  ```

**인덱스 최적화**
- [ ] 자주 사용되는 쿼리 분석
- [ ] 복합 인덱스 추가 (필요 시)
  ```sql
  CREATE INDEX idx_gen_user_created ON generation_history(user_id, created_at DESC);
  ```

**쿼리 최적화**
- [ ] N+1 쿼리 문제 확인
- [ ] JOIN 최적화
- [ ] 페이지네이션 개선

**캐싱 (선택)**
- [ ] Redis 설치 (선택)
- [ ] 자주 조회되는 데이터 캐싱
  - [ ] 사용자 정보
  - [ ] 최근 이력 (5분 TTL)

### 🗓 5주차 (1/23 ~ 1/27): 마무리

#### Day 25-27 (1/23-1/25): 최종 테스트 및 버그 수정

**통합 테스트**
- [ ] 전체 워크플로우 테스트
  - [ ] 회원가입 → 로그인 → 광고 생성 → 이력 조회
- [ ] 동시 요청 처리 테스트
  - [ ] 10개 동시 생성 요청
- [ ] 장시간 실행 테스트 (1시간)

**DB 부하 테스트**
- [ ] 대량 데이터 삽입
  ```python
  for i in range(1000):
      db.save_generation_history({...})
  ```
- [ ] 조회 성능 측정
- [ ] 연결 풀 동작 확인

**에러 로그 분석**
- [ ] logs/ 디렉토리 확인
- [ ] 반복되는 에러 패턴 파악
- [ ] 에러 처리 개선

#### Day 28-30 (1/26-1/27): 데이터베이스 최종 정리

**DB 백업 스크립트 작성**
- [ ] backup.sh 작성
  ```bash
  #!/bin/bash
  DATE=$(date +%Y%m%d_%H%M%S)
  pg_dump -U ad_user ad_generator > backup_$DATE.sql
  ```
- [ ] cron 설정 (매일 자정)
  ```bash
  0 0 * * * /path/to/backup.sh
  ```

**Cloud SQL 마이그레이션 준비 (선택)**
- [ ] Cloud SQL 인스턴스 생성
- [ ] 데이터 마이그레이션 스크립트
- [ ] 연결 설정 변경

**문서화**
- [ ] DB 스키마 문서 작성
- [ ] API 함수 docstring 추가
- [ ] 에러 코드 정리

**✅ 최종 완료**: 백엔드 비즈니스 로직 완성 및 배포 준비

---

## 📊 진행 상황 추적

### 1단계 (MVP) 체크리스트 요약

**1주차**: PostgreSQL 설정 + 테이블 생성 + 기본 CRUD
- [ ] PostgreSQL 설치 및 DB 생성
- [ ] 4개 테이블 생성 (user, generation_history, chat_history, image_matching)
- [ ] 8개 CRUD 함수 구현

**2주차**: services.py 워크플로우 + 인증 준비
- [ ] create_advertisement() 함수 완성
- [ ] register_user() 함수
- [ ] authenticate_user() 함수
- [ ] schemas.py 스키마 정의

**3주차**: 인증 테스트 + 이력 조회
- [ ] 인증 로직 테스트 (정상/에러 케이스)
- [ ] get_generation_history() 함수
- [ ] get_chat_sessions(), get_chat_history() (2단계 준비)

### 2단계 (개선) 체크리스트 요약

**4주차**: 채팅 세션 + 성능 최적화
- [ ] 세션 관리 로직
- [ ] DB 연결 풀
- [ ] 인덱스 최적화

**5주차**: 테스트 + 백업
- [ ] 통합 테스트
- [ ] DB 백업 스크립트
- [ ] 문서화

---

## 🤝 협업 포인트

### 이유노님과의 협업
- [ ] schemas.py 스키마 공유
- [ ] routes.py에서 services.py 함수 호출
- [ ] 에러 응답 형식 협의

### 이현석님과의 협업
- [ ] UnifiedImageGenerator 인터페이스 확인
  - [ ] `generate()` 함수 입력/출력
  - [ ] 메타데이터 형식 (seed, style)

### 배현석님과의 협업
- [ ] PromptTemplateManager, TextGenerator 인터페이스 확인
  - [ ] `generate_image_prompt()` 출력
  - [ ] `generate_ad_copy()` 출력

### 신승목님과의 협업
- [ ] `save_image()` 함수 인터페이스 확인
- [ ] DB 연결 설정 공유
- [ ] 테스트 코드 작성 협업

---

## 📝 참고 사항

### PostgreSQL 유용한 명령어
```sql
-- 테이블 목록
\dt

-- 테이블 구조
\d table_name

-- 모든 사용자 조회
SELECT * FROM "user";

-- 최근 생성 이력
SELECT * FROM generation_history ORDER BY created_at DESC LIMIT 10;

-- 특정 사용자 이력 개수
SELECT COUNT(*) FROM generation_history WHERE user_id = 1;
```

### Python DB 연결 테스트
```python
from src.backend.db_processor import DBProcessor

db = DBProcessor()
conn = db.get_connection()
print("연결 성공!")
conn.close()
```

### bcrypt 사용법
```python
import bcrypt

# 해시 생성
hashed = bcrypt.hashpw('password'.encode(), bcrypt.gensalt())

# 비밀번호 검증
is_valid = bcrypt.checkpw('password'.encode(), hashed)
```

---

**작성일**: 2026-01-02
**담당자**: 진수경님 (백엔드 비즈니스 로직)  
**최종 수정**: 2026-01-02
