---
layout: default
title: "협업일지 Day 6 (2026-01-06) - 코드잇 AI 4기 4팀 이현석"
description: "협업일지 Day 6 (2026-01-06) - 코드잇 AI 4기 4팀 이현석"
date: 2026-01-06
author: "이현석"
cache-control: no-cache
expires: 0
pragma: no-cache
---

# 일일 협업일지 - Day 6 (2026-01-06)

## [1] 기본 정보
**날짜**: 2026-01-06
**이름**: 이현석
**팀명**: 코드잇 AI 4기 4팀

---

## [2] 오늘 맡은 역할 및 구체적인 작업 내용
**답변**:
```
ControlNet 기반 Image-to-Image (I2I) 생성 기능 구현 및 통합
- ControlNet Preprocessor Node 구현 (Canny/Depth/Openpose 지원)
- ControlNet Loader Node 구현 (SDXL ControlNet 모델 로드)
- Image2ImageControlNetNode 구현 (제품 형태 유지 + 스타일 변환)
- generator.py에 자동 T2I/I2I 분기 처리 구현
- generation.py → text2image.py 파일명 통일
- test_controlnet.py 테스트 스크립트 작성
- 의존성 패키지 이슈 해결 (controlnet-aux, mediapipe, timm, diffusers)
- 프롬프트 품질 개선 (제품별 상세 프롬프트 적용)
```

---

## [3] 오늘 작업 완료도 체크 (하나만 체크)
- [ ] 0% (시작 못함)
- [ ] 25% (시작은 했지만 진척 없음)
- [ ] 50% (진행 중, 절반 이하)
- [ ] 75% (거의 완료됨)
- [x] 100% (완료 및 점검까지 완료)

**간단한 근거**:
```
ControlNet I2I 기능 완전 구현 및 테스트 완료
- T2I/I2I 자동 분기 처리로 백엔드 연동 간소화
- 3가지 ControlNet 타입 (Canny/Depth/Openpose) 모두 작동
- 멀티 스타일 테스트 성공 (Ultra Realistic/Semi Realistic/Anime)
- 프롬프트 엔지니어링으로 이미지 품질 향상
- VAE 캐시 공유로 T2I/I2I 간 메모리 효율화
```

---

## [4] 오늘 협업 중 제안하거나 피드백한 내용이 있다면?
**답변**:
```
백엔드와 이미지 처리 시퀀스 논의:
- reference_image 파라미터 유무에 따른 T2I/I2I 자동 분기 처리 구현
- generator.py 단일 진입점으로 백엔드 연동 간소화
```

---

## [5] 오늘 분석/실험 중 얻은 인사이트나 발견한 문제점은?
**답변**:
```
주요 발견:

1. 의존성 패키지 버전 호환성 이슈
   - controlnet_aux가 mediapipe 0.10.9 이하만 지원
   - timm 1.0.x는 controlnet_aux와 호환 불가 (0.9.16으로 다운그레이드)
   - diffusers ControlNet 파이프라인 별도 설치 필요

2. 모델 캐싱 경로 문제
   - 상대 경로 Path("models")는 실행 위치에 따라 다른 폴더 생성
   - Path(__file__).parent.parent / "models"로 절대 경로 사용으로 해결
   - 5GB ControlNet 모델 중복 다운로드 방지

3. 프롬프트 엔지니어링의 중요성
   - 초기: "professional product photo" 등 일반적 프롬프트 → 품질 저하
   - 개선: "Korean salt bread roll, oval-shaped golden brown bread with white salt crystals" 등 구체적 묘사 → 품질 대폭 향상
   - ControlNet은 형태만 유지, 내용은 프롬프트에 의존

4. VAE 공유 아키텍처
   - Text2ImageNode와 Image2ImageControlNetNode가 클래스 변수로 VAE 캐시 공유
   - 모델 전환 시 VAE 재로드 시간 절약
   - 메모리 효율성 개선

기술적 해결:
- ControlNetPreprocessorNode: Canny/Depth/Openpose 자동 전처리
- ControlNetLoaderNode: SDXL ControlNet 모델 lazy loading
- Image2ImageControlNetNode: StableDiffusionXLControlNetPipeline 사용
- controlnet_conditioning_scale (0.8): 형태 유지 강도 조절
```

---

## [6] 일정 지연이나 협업 중 어려웠던 점이 있다면?
**답변**:
```
의존성 패키지 충돌 해결에 시간 소요:
- mediapipe 0.10.31 설치 시 AttributeError 발생
- lazy import 제안했으나 사용자 거부
- 버전 다운그레이드로 해결 (mediapipe 0.10.9, timm 0.9.16)

프롬프트 품질 개선 반복:
- 초기 생성 이미지가 소금빵처럼 보이지 않음
- 일반적인 "professional product photo" 프롬프트의 한계
- 제품별 상세 특징 (색상, 형태, 재질) 명시로 해결

파일명 통일 작업:
- generation.py가 실제론 T2I 전용인데 이름이 일반적
- image2image.py와 대칭되도록 text2image.py로 변경
- 모든 의존성 파일 import 수정 (generator.py, test_workflow.py, image2image.py, __init__.py, Image_README.md)
```

---

## [7] 오늘 발표 준비나 커뮤니케이션에서 기여한 부분은?
**답변**:
```
없음
```

---

## [8] 내일 목표 / 할 일
**답변**:
```
1. T2I 후처리 노드 구현 (텍스트 오버레이, 압축)
2. 백엔드 팀과 API 통합 작업
3. 실제 비즈니스 데이터 테스트
4. 프롬프트 최적화 (배현석님 TextGenerator 연동)
5. 에러 처리 강화
```

---

## [9] 추가 기록 (선택사항)

```
신규 작성한 파일:

1. nodes/controlnet.py
   - ControlNetPreprocessorNode
     * Canny: CannyDetector (윤곽선 추출)
     * Depth: MidasDetector (깊이 맵)
     * Openpose: OpenposeDetector (포즈 추출)
   - ControlNetLoaderNode
     * SDXL ControlNet 모델 로드
     * 모델 맵: canny, depth, openpose

2. nodes/image2image.py
   - Image2ImageControlNetNode
     * StableDiffusionXLControlNetPipeline 사용
     * Text2ImageNode와 VAE 캐시 공유
     * controlnet_conditioning_scale: 0.8 기본값
     * auto_unload 지원

3. test_controlnet.py
   - test_controlnet_basic(): Canny + Ultra Realistic 테스트
   - test_controlnet_multi_style(): 3가지 스타일 (Ultra/Semi/Anime) 테스트
   - 제품별 상세 프롬프트 적용

수정한 파일:

1. generator.py
   - generate_and_save_image()에 reference_image 파라미터 추가
   - reference_image 유무에 따라 T2I/I2I 자동 분기
   - generate_with_controlnet() 함수 추가
     * ControlNetPreprocessorNode
     * ControlNetLoaderNode
     * Image2ImageControlNetNode
     * 3개 노드 연결 워크플로우

2. nodes/generation.py → nodes/text2image.py
   - 파일명 변경으로 명확한 역할 표시
   - 모든 의존성 파일 import 경로 수정

3. nodes/__init__.py
   - ControlNetPreprocessorNode, ControlNetLoaderNode 추가
   - Image2ImageControlNetNode 추가
   - text2image로 import 경로 수정

패키지 설치:
```bash
pip install controlnet-aux
pip install mediapipe==0.10.9
pip install "timm==0.9.16"
pip install diffusers transformers accelerate
```

Backend API 연동 예시:
```python
from src.generation.image_generation.generator import generate_and_save_image
from PIL import Image

# Text-to-Image (reference_image=None)
result_t2i = generate_and_save_image(
    prompt="professional bakery interior with fresh croissants",
    style="ultra_realistic",
    aspect_ratio="16:9",
    business_id="user123"
)

# Image-to-Image (reference_image 제공)
reference = Image.open("product_photo.jpg")
result_i2i = generate_and_save_image(
    prompt="professional food photography of Korean salt bread roll, oval-shaped golden brown bread with white salt crystals on top",
    reference_image=reference,  # I2I 모드로 자동 전환
    control_type="canny",
    style="ultra_realistic",
    aspect_ratio="1:1",
    controlnet_conditioning_scale=0.8,
    business_id="user123"
)
```

ControlNet 파라미터:
- **control_type**: "canny" (윤곽선), "depth" (깊이), "openpose" (포즈)
- **controlnet_conditioning_scale**: 0.0~1.0 (형태 유지 강도, 기본 0.8)
- **num_inference_steps**: 40 (기본값, 품질 중시)
- **guidance_scale**: 7.5 (기본값)

프롬프트 품질 개선 사례:
- AS-IS: "professional product photo, ultra realistic style"
- TO-BE: "professional food photography of Korean salt bread roll, oval-shaped golden brown bread with white salt crystals on top, soft fluffy texture, glossy surface, fresh from bakery, warm lighting, wooden table, clean background, high quality detailed commercial photo, appetizing presentation"

다음 단계:
- 제품별 프롬프트 템플릿 DB 구축
- ControlNet 타입별 최적 사용 케이스 정립
- 후처리 레이어에서 로고/텍스트 오버레이
- 배현석님 Text Generator와 프롬프트 연동
```

---

**작성 시간**: 5분
