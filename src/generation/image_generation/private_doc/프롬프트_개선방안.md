# 프롬프트 생성 시스템 개선방안

## 1. 현재 시스템 분석

### 1.1 현재 아키텍처
```
[한글 입력] → [GPT 키워드 추출] → [HybridPromptBuilder] → [Positive/Negative Prompt]
                                         ↓
                              industries.yaml 템플릿 참조
```

### 1.2 현재 문제점

| 문제 | 설명 | 영향 |
|------|------|------|
| **Realistic Only** | 모든 템플릿이 "Professional photography of..." 형태 | Anime/Illustration 스타일 생성 불가 |
| **Style 미활용** | `style` 파라미터가 Negative에만 영향 | Positive prompt에 스타일 반영 안됨 |
| **텍스트 생성** | Negative에 "text" 있지만 약함 | 이미지에 텍스트가 생성됨 |
| **의도 누락** | "어떻게" 그릴지 정보 없음 | 사용자 의도 반영 불가 |

### 1.3 현재 파일 구조
```
prompt/
├── prompt_manager.py      # GPT 키워드 추출
├── config_loader.py       # PromptGenerator (통합)
├── prompt_templates.py    # HybridPromptBuilder, NegativePromptBuilder
└── config/
    └── industries.yaml    # 업종별 템플릿 (현재 realistic only)
```

---

## 2. 개선 아키텍처

### 2.1 새로운 파이프라인

```
[한글 입력]
    ↓
[GPT 키워드 추출] ← 사용자 의도 추가 (style, purpose, tone)
    ↓
[StyleRouter] ← NEW: 스타일별 분기
    ├── realistic → RealisticPromptBuilder
    ├── anime → AnimePromptBuilder
    └── illustration → IllustrationPromptBuilder
    ↓
[PromptAssembler] ← NEW: 최종 조립 + 텍스트 방지 강화
    ↓
[Positive/Negative Prompt]
```

### 2.2 핵심 변경 사항

#### A. 사용자 의도 수집 (prompt_manager.py)
```python
# 현재: 시각적 요소만 추출
{"product": "strawberry latte", "theme": "warm"}

# 개선: 의도 + 시각적 요소
{
    "product": "strawberry latte",
    "theme": "warm",
    # NEW
    "style": "realistic",        # realistic / anime / illustration
    "purpose": "promotion",      # promotion / menu / sns / poster
    "tone": "warm_friendly",     # warm / cool / professional / playful
    "target": "young_adult"      # 타겟 연령/성향
}
```

#### B. 스타일별 분기 (style_router.py) - NEW
```python
class StyleRouter:
    """스타일에 따라 적절한 빌더로 분기"""

    def route(self, style: str, industry: str, user_input: dict):
        if style == "realistic":
            return RealisticPromptBuilder(industry)
        elif style == "anime":
            return AnimePromptBuilder(industry)
        elif style == "illustration":
            return IllustrationPromptBuilder(industry)
```

#### C. 스타일별 템플릿 (config/)
```
config/
├── industries.yaml           # 공통 업종 정보
├── styles/
│   ├── realistic.yaml        # 실사 스타일 템플릿
│   ├── anime.yaml            # 애니메이션 스타일 템플릿
│   └── illustration.yaml     # 일러스트 스타일 템플릿
```

#### D. 텍스트 방지 강화 (prompt_templates.py)
```python
# Negative Prompt 강화
ANTI_TEXT_KEYWORDS = [
    "text", "letters", "words", "watermark", "signature",
    "caption", "subtitle", "logo", "label", "writing",
    "typography", "font", "characters", "numbers"
]

# Positive Prompt에 추가
"no text, text-free image, clean composition without text"
```

---

## 3. 스타일별 프롬프트 전략

### 3.1 Realistic (실사)
```
Medium: "Professional commercial photography of..."
Style: "shot on Canon EOS R5, 85mm f/1.4, natural lighting"
Quality: "high resolution, sharp focus, professional color grading"
```

### 3.2 Anime (애니메이션)
```
Medium: "anime style illustration of..."
Style: "anime aesthetic, vibrant colors, clean lineart"
Quality: "detailed anime art, studio quality, modern anime style"
Tags: "anime, 2D, cel shading" (모델 특화 태그)
```

### 3.3 Illustration (일러스트)
```
Medium: "digital illustration of..."
Style: "flat design, modern illustration, vector art style"
Quality: "clean lines, balanced composition, professional illustration"
```

---

## 4. 파일별 수정 계획

### 4.1 prompt_manager.py
- [ ] 시스템 프롬프트에 style/purpose/tone 추출 로직 추가
- [ ] 사용자 의도 감지 로직 추가

### 4.2 style_router.py (NEW)
- [ ] StyleRouter 클래스 생성
- [ ] 스타일별 빌더 분기 로직

### 4.3 prompt_templates.py
- [ ] AnimePromptBuilder 추가
- [ ] IllustrationPromptBuilder 추가
- [ ] ANTI_TEXT_KEYWORDS 상수 추가
- [ ] NegativePromptBuilder.build()에 텍스트 방지 강화

### 4.4 config/styles/*.yaml (NEW)
- [ ] realistic.yaml - 현재 템플릿 기반
- [ ] anime.yaml - 애니메이션 특화 템플릿
- [ ] illustration.yaml - 일러스트 특화 템플릿

### 4.5 config_loader.py
- [ ] PromptGenerator.generate()에 style 파라미터 전달
- [ ] StyleRouter 통합

---

## 5. 고품질 프롬프트 예시

### 5.1 목표 프롬프트 (카페 신메뉴 홍보)

**Input:**
```
"카페 신메뉴 딸기라떼 홍보, 따뜻하고 친근한 느낌, SNS용"
```

**Realistic Output:**
```
Positive:
Professional commercial photography of a freshly made strawberry latte
in a tall glass, topped with whipped cream and fresh strawberry slices,
placed on a marble cafe table, warm natural lighting streaming through
window, cozy cafe interior background with soft bokeh, inviting and
appetizing presentation, soft pink and cream color palette,
shot on Canon EOS R5 with 85mm f/1.4 lens, shallow depth of field,
professional food photography, text-free clean composition

Negative:
text, letters, words, watermark, logo, writing, typography,
cartoon, illustration, artificial, low quality, blurry
```

**Anime Output:**
```
Positive:
anime style illustration of strawberry latte in tall glass,
topped with whipped cream and strawberry, on cafe table,
warm cozy cafe background, soft afternoon lighting,
pastel pink and cream colors, appetizing food illustration,
detailed anime art style, clean lineart, vibrant but soft colors,
modern anime aesthetic, text-free composition

Negative:
text, letters, words, watermark, logo, writing,
photorealistic, photograph, 3D render, low quality
```

---

## 6. 구현 우선순위

### Phase 1: 텍스트 방지 (최우선)
1. NegativePromptBuilder에 ANTI_TEXT_KEYWORDS 추가
2. Positive에 "text-free" 구문 추가
3. 테스트

### Phase 2: 스타일 분기
1. style_router.py 생성
2. config/styles/*.yaml 생성
3. config_loader.py 수정

### Phase 3: 사용자 의도
1. prompt_manager.py 시스템 프롬프트 개선
2. purpose/tone 추출 로직 추가
3. 통합 테스트

---

## 7. 테스트 체크리스트

- [ ] 텍스트 없는 이미지 생성 확인
- [ ] Realistic 스타일 정상 동작
- [ ] Anime 스타일 정상 동작
- [ ] Illustration 스타일 정상 동작
- [ ] 업종별 템플릿 적용 확인
- [ ] 사용자 의도 반영 확인
