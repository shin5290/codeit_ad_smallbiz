<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <title>관리자 페이지</title>
    <link rel="icon" type="image/png" sizes="16x16" href="/static/favicon.png">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+KR:wght@400;500;600;700&display=swap">
    <script>
        try {
            const savedView = sessionStorage.getItem('admin_view');
            const allowedViews = ['sessions', 'logs', 'users', 'generations'];
            document.documentElement.dataset.view = allowedViews.includes(savedView) ? savedView : 'sessions';
        } catch {
            document.documentElement.dataset.view = 'sessions';
        }
    </script>
    <link rel="stylesheet" href="/static/admin.css">
</head>

<body>
    <div class="layout">
        <aside class="sidebar">
            <div class="brand">관리자 대시보드</div>
            <div class="nav">
                <button class="active" data-view="sessions">세션</button>
                <button data-view="logs">로그</button>
                <button data-view="users">회원목록</button>
                <button data-view="generations">생성이력</button>
            </div>
            <div class="sidebar-footer">
                <button id="logoutBtn">로그아웃</button>
            </div>
        </aside>

        <main class="content">
            <section id="view-sessions" class="panel">
                <div class="toolbar">
                    <div class="left">
                        <h2>세션</h2>
                        <span id="sessionCount" class="status-text"></span>
                    </div>
                </div>
                <div class="panel" style="background:#f9fafb; box-shadow:none; margin-bottom: 15px;">
                    <div class="filters">
                        <div class="search-field">
                            <input type="text" id="sessionFilterQuery" placeholder="session_id 검색" aria-label="세션 ID 검색">
                        </div>
                        <div class="search-field">
                            <input type="number" id="sessionFilterUserId" placeholder="user_id" aria-label="user ID">
                        </div>
                        <div class="search-field">
                            <input type="date" id="sessionFilterFromDate" aria-label="시작 날짜">
                        </div>
                        <div class="search-field">
                            <input type="date" id="sessionFilterToDate" aria-label="종료 날짜">
                        </div>
                        <div class="search-actions">
                            <button id="searchSessionsBtn" class="primary">검색</button>
                            <button id="resetSessionsBtn" class="secondary">초기화</button>
                        </div>
                    </div>
                </div>
                <div class="table-scroll">
                    <table>
                        <thead>
                            <tr>
                                <th>세션 ID</th>
                                <th>사용자</th>
                                <th>USER ID</th>
                                <th>생성 시각</th>
                                <th>마지막 메시지</th>
                                <th>메시지 수</th>
                                <th>상태</th>
                            </tr>
                        </thead>
                        <tbody id="sessionTableBody"></tbody>
                    </table>
                </div>
                <div class="pagination">
                    <button id="sessionPrevPageBtn" class="secondary">이전</button>
                    <div class="status-text">
                        <input type="number" id="sessionPageInput" class="page-input" min="1" step="1" aria-label="세션 페이지 이동">
                        <span id="sessionPageInfo"></span>
                    </div>
                    <button id="sessionNextPageBtn" class="secondary">다음</button>
                </div>

                <div class="panel session-detail">
                    <div class="toolbar">
                        <div class="left">
                            <h2>세션 상세</h2>
                            <span id="sessionDetailSubtitle" class="status-text"></span>
                        </div>
                        <div class="right">
                            <button id="sessionLogJumpBtn" class="secondary" disabled>로그 보기</button>
                        </div>
                    </div>
                    <div id="sessionDetailEmpty" class="empty-state">세션을 선택하세요.</div>
                    <div id="sessionDetailBody" class="hidden">
                        <div id="sessionMeta" class="meta-list"></div>
                        <div class="session-detail-grid">
                            <div>
                                <h3 class="section-title">채팅 타임라인</h3>
                                <div id="sessionTimeline" class="timeline"></div>
                                <div class="detail-actions">
                                    <button id="sessionLoadMoreBtn" class="secondary">이전 메시지 더보기</button>
                                </div>
                            </div>
                            <div>
                                <h3 class="section-title">생성 요약</h3>
                                <div id="sessionGenerations" class="generation-summary"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="panel message-search">
                    <div class="toolbar">
                        <div class="left">
                            <h2>채팅 이력 검색</h2>
                            <span id="messageSearchCount" class="status-text"></span>
                        </div>
                    </div>
                    <div class="panel" style="background:#f9fafb; box-shadow:none; margin-bottom: 15px;">
                        <div class="filters">
                            <div class="search-field">
                                <input type="text" id="messageSearchKeyword" placeholder="키워드" aria-label="검색 키워드">
                            </div>
                            <div class="search-field">
                                <select id="messageSearchLevel" aria-label="에러 필터">
                                    <option value="">전체</option>
                                    <option value="error">에러/실패</option>
                                    <option value="warn">경고</option>
                                </select>
                            </div>
                            <div class="search-field">
                                <input type="date" id="messageSearchFromDate" aria-label="시작 날짜">
                            </div>
                            <div class="search-field">
                                <input type="date" id="messageSearchToDate" aria-label="종료 날짜">
                            </div>
                            <div class="search-actions">
                                <button id="messageSearchBtn" class="primary">검색</button>
                                <button id="messageResetBtn" class="secondary">초기화</button>
                            </div>
                        </div>
                    </div>
                    <div class="table-scroll">
                        <table>
                            <thead>
                                <tr>
                                    <th>세션 ID</th>
                                    <th>role</th>
                                    <th>내용</th>
                                    <th>작성 시각</th>
                                </tr>
                            </thead>
                            <tbody id="messageSearchTableBody"></tbody>
                        </table>
                    </div>
                    <div class="pagination">
                        <button id="messagePrevPageBtn" class="secondary">이전</button>
                        <div class="status-text">
                            <input type="number" id="messagePageInput" class="page-input" min="1" step="1" aria-label="채팅 검색 페이지 이동">
                            <span id="messagePageInfo"></span>
                        </div>
                        <button id="messageNextPageBtn" class="secondary">다음</button>
                    </div>
                </div>
            </section>

            <section id="view-logs" class="panel hidden">
                <div class="toolbar">
                    <div class="left">
                        <h2>로그</h2>
                        <span id="logStatus" class="status-text"></span>
                    </div>
                    <div class="right">
                        <button id="logRefreshBtn" class="secondary">새로고침</button>
                    </div>
                </div>
                <div class="panel" style="background:#f9fafb; box-shadow:none; margin-bottom: 15px;">
                    <div class="filters">
                        <div class="search-field">
                            <select id="logDateSelect" aria-label="로그 날짜"></select>
                        </div>
                        <div class="search-field">
                            <select id="logFileSelect" aria-label="로그 파일"></select>
                        </div>
                        <div class="search-field">
                            <input type="number" id="logLinesInput" min="10" max="1000" placeholder="줄 수" aria-label="라인 수">
                        </div>
                        <div class="search-field">
                            <input type="text" id="logKeywordInput" placeholder="키워드" aria-label="로그 키워드">
                        </div>
                        <div class="search-field">
                            <select id="logLevelSelect" aria-label="로그 레벨">
                                <option value="">전체</option>
                                <option value="error">error</option>
                                <option value="warn">warn</option>
                                <option value="info">info</option>
                                <option value="debug">debug</option>
                                <option value="critical">critical</option>
                            </select>
                        </div>
                        <div class="search-field inline-field">
                            <label class="checkbox-label">
                                <input type="checkbox" id="logMaskToggle" checked>
                                토큰 마스킹
                            </label>
                        </div>
                        <div class="search-actions">
                            <button id="logTailBtn" class="primary">미리보기</button>
                            <button id="logStreamBtn" class="secondary">Start</button>
                            <button id="logPauseBtn" class="secondary" disabled>Pause</button>
                        </div>
                    </div>
                </div>
                <div class="panel log-output">
                    <div class="log-output-header">
                        <label class="checkbox-label">
                            <input type="checkbox" id="logAutoScrollToggle" checked>
                            Auto-scroll
                        </label>
                        <button id="logClearBtn" class="secondary">Clear</button>
                    </div>
                    <div id="logOutput" class="log-output-body" aria-live="polite"></div>
                </div>
            </section>

            <section id="view-users" class="panel hidden">
                <div class="toolbar">
                    <div class="left">
                        <h2>회원목록</h2>
                        <span id="userCount" class="status-text"></span>
                    </div>
                </div>
                <div class="panel" style="background:#f9fafb; box-shadow:none; margin-bottom: 15px;">
                    <div class="filters">
                        <div class="search-type">
                            <select id="userSearchTypeSelect" aria-label="검색 타입">
                                <option value="login_id">사용자 ID</option>
                                <option value="user_id">USER ID</option>
                                <option value="created_at">가입일</option>
                                <option value="role">권한</option>
                                <option value="name">이름</option>
                            </select>
                        </div>
                        <div class="search-field" data-search-scope="user" data-search-type="login_id">
                            <input type="text" id="userFilterLoginId" placeholder="예: admin" aria-label="사용자 ID">
                        </div>
                        <div class="search-field hidden" data-search-scope="user" data-search-type="user_id">
                            <input type="number" id="userFilterUserId" placeholder="예: 1" aria-label="user ID">
                        </div>
                        <div class="search-field hidden" data-search-scope="user" data-search-type="name">
                            <input type="text" id="userFilterName" placeholder="예: 홍길동" aria-label="이름">
                        </div>
                        <div class="search-field hidden" data-search-scope="user" data-search-type="created_at">
                            <input type="date" id="userFilterCreatedDate" aria-label="가입일">
                        </div>
                        <div class="search-field hidden" data-search-scope="user" data-search-type="role">
                            <select id="userFilterRole" aria-label="권한">
                                <option value="">전체</option>
                                <option value="admin">admin</option>
                                <option value="user">user</option>
                            </select>
                        </div>
                        <div class="search-actions">
                            <button id="searchUsersBtn" class="primary">검색</button>
                            <button id="resetUsersBtn" class="secondary">초기화</button>
                        </div>
                    </div>
                </div>
                <div class="table-scroll">
                    <table>
                        <thead>
                            <tr>
                                <th><input type="checkbox" id="selectAllUsers"></th>
                                <th>사용자 ID</th>
                                <th>USER ID</th>
                                <th>이름</th>
                                <th>가입일</th>
                                <th>권한</th>
                            </tr>
                        </thead>
                        <tbody id="userTableBody"></tbody>
                    </table>
                </div>
                <div class="table-footer">
                    <button id="deleteUsersBtn" class="danger">선택 삭제</button>
                    <div class="pagination">
                        <button id="userPrevPageBtn" class="secondary">이전</button>
                        <div class="status-text">
                            <input type="number" id="userPageInput" class="page-input" min="1" step="1" aria-label="회원목록 페이지 이동">
                            <span id="userPageInfo"></span>
                        </div>
                        <button id="userNextPageBtn" class="secondary">다음</button>
                    </div>
                </div>
            </section>

            <section id="view-generations" class="panel hidden">
                <div class="toolbar">
                    <div class="left">
                        <h2>생성이력</h2>
                        <span id="generationCount" class="status-text"></span>
                    </div>
                </div>

                <div class="panel" style="background:#f9fafb; box-shadow:none; margin-bottom: 15px;">
                    <div class="filters">
                        <div class="search-type">
                            <select id="searchTypeSelect" aria-label="검색 타입">
                                <option value="login_id">사용자 ID</option>
                                <option value="user_id">user ID</option>
                                <option value="session_id">세션 ID</option>
                                <option value="content_type">생성 타입</option>
                                <option value="created_at">생성 날짜</option>
                            </select>
                        </div>
                        <div class="search-field" data-search-scope="generation" data-search-type="login_id">
                            <input type="text" id="filterLoginId" placeholder="예: admin" aria-label="사용자 ID">
                        </div>
                        <div class="search-field hidden" data-search-scope="generation" data-search-type="user_id">
                            <input type="number" id="filterUserId" placeholder="예: 1" aria-label="user ID">
                        </div>
                        <div class="search-field hidden" data-search-scope="generation" data-search-type="session_id">
                            <input type="text" id="filterSessionId" placeholder="session_id" aria-label="세션 ID">
                        </div>
                        <div class="search-field hidden" data-search-scope="generation" data-search-type="content_type">
                            <select id="filterContentType" aria-label="생성 타입">
                                <option value="">전체</option>
                                <option value="image">image</option>
                                <option value="text">text</option>
                            </select>
                        </div>
                        <div class="search-field hidden" data-search-scope="generation" data-search-type="created_at">
                            <input type="date" id="filterCreatedDate" aria-label="생성 날짜">
                        </div>
                        <div class="search-actions">
                            <button id="searchGenerationsBtn" class="primary">검색</button>
                            <button id="resetGenerationsBtn" class="secondary">초기화</button>
                        </div>
                    </div>
                </div>

                <div class="table-scroll">
                    <table>
                        <thead>
                            <tr>
                                <th class="nowrap">사용자</th>
                                <th>입력</th>
                                <th>생성</th>
                                <th>메타 데이터</th>
                                <th>생성 날짜</th>
                            </tr>
                        </thead>
                        <tbody id="generationTableBody"></tbody>
                    </table>
                </div>
                <div class="pagination">
                    <button id="prevPageBtn" class="secondary">이전</button>
                    <div class="status-text">
                        <input type="number" id="pageInput" class="page-input" min="1" step="1" aria-label="페이지 이동">
                        <span id="pageInfo"></span>
                    </div>
                    <button id="nextPageBtn" class="secondary">다음</button>
                </div>
            </section>
        </main>
    </div>

    <div id="loginOverlay" class="login-overlay hidden">
        <div class="login-panel">
            <h3>관리자 로그인</h3>
            <input type="text" id="loginId" placeholder="아이디" autocomplete="username">
            <input type="password" id="loginPw" placeholder="비밀번호" autocomplete="current-password">
            <button id="loginBtn">로그인</button>
            <p id="loginError" class="status-text"></p>
        </div>
    </div>

    <div id="image-modal" class="hidden" onclick="closeImageModal()">
        <span class="close-modal">&times;</span>
        <img id="modal-image" src="" alt="preview">
    </div>

    <div id="text-modal" class="hidden">
        <div class="text-modal-panel">
            <div class="text-modal-header">
                <h3 id="text-modal-title">텍스트 상세</h3>
                <button type="button" class="text-modal-close" id="text-modal-close">닫기</button>
            </div>
            <div id="text-modal-content" class="text-modal-content"></div>
        </div>
    </div>

    <div id="user-modal" class="hidden">
        <div class="text-modal-panel">
            <div class="text-modal-header">
                <h3 id="user-modal-title">사용자 정보</h3>
                <button type="button" class="text-modal-close" id="user-modal-close">닫기</button>
            </div>
            <div id="user-modal-list" class="user-modal-content"></div>
        </div>
    </div>

    <script src="/static/admin.js" defer></script>
</body>

</html>
