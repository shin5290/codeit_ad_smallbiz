<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <title>관리자 페이지</title>
    <link rel="icon" type="image/png" sizes="16x16" href="/static/favicon.png">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+KR:wght@400;500;600;700&display=swap">
    <script>
        try {
            const savedView = sessionStorage.getItem('admin_view');
            document.documentElement.dataset.view = savedView === 'generations' ? 'generations' : 'users';
        } catch {
            document.documentElement.dataset.view = 'users';
        }
    </script>
    <link rel="stylesheet" href="/static/admin.css">
</head>

<body>
    <div class="layout">
        <aside class="sidebar">
            <div class="brand">관리자 대시보드</div>
            <div class="nav">
                <button class="active" data-view="users">회원목록</button>
                <button data-view="generations">생성이력</button>
            </div>
            <div class="sidebar-footer">
                <button id="logoutBtn">로그아웃</button>
            </div>
        </aside>

        <main class="content">
            <section id="view-users" class="panel">
                <div class="toolbar">
                    <div class="left">
                        <h2>회원목록</h2>
                        <span id="userCount" class="status-text"></span>
                    </div>
                </div>
                <div class="panel" style="background:#f9fafb; box-shadow:none; margin-bottom: 15px;">
                    <div class="filters">
                        <div class="search-type">
                            <select id="userSearchTypeSelect" aria-label="검색 타입">
                                <option value="login_id">사용자 ID</option>
                                <option value="user_id">USER ID</option>
                                <option value="created_at">가입일</option>
                                <option value="role">권한</option>
                                <option value="name">이름</option>
                            </select>
                        </div>
                        <div class="search-field" data-search-scope="user" data-search-type="login_id">
                            <input type="text" id="userFilterLoginId" placeholder="예: admin" aria-label="사용자 ID">
                        </div>
                        <div class="search-field hidden" data-search-scope="user" data-search-type="user_id">
                            <input type="number" id="userFilterUserId" placeholder="예: 1" aria-label="user ID">
                        </div>
                        <div class="search-field hidden" data-search-scope="user" data-search-type="name">
                            <input type="text" id="userFilterName" placeholder="예: 홍길동" aria-label="이름">
                        </div>
                        <div class="search-field hidden" data-search-scope="user" data-search-type="created_at">
                            <input type="date" id="userFilterCreatedDate" aria-label="가입일">
                        </div>
                        <div class="search-field hidden" data-search-scope="user" data-search-type="role">
                            <select id="userFilterRole" aria-label="권한">
                                <option value="">전체</option>
                                <option value="admin">admin</option>
                                <option value="user">user</option>
                            </select>
                        </div>
                        <div class="search-actions">
                            <button id="searchUsersBtn" class="primary">검색</button>
                            <button id="resetUsersBtn" class="secondary">초기화</button>
                        </div>
                    </div>
                </div>
                <div class="table-scroll">
                    <table>
                        <thead>
                            <tr>
                                <th><input type="checkbox" id="selectAllUsers"></th>
                                <th>사용자 ID</th>
                                <th>USER ID</th>
                                <th>이름</th>
                                <th>가입일</th>
                                <th>권한</th>
                            </tr>
                        </thead>
                        <tbody id="userTableBody"></tbody>
                    </table>
                </div>
                <div class="table-footer">
                    <button id="deleteUsersBtn" class="danger">선택 삭제</button>
                    <div class="pagination">
                        <button id="userPrevPageBtn" class="secondary">이전</button>
                        <div class="status-text">
                            <input type="number" id="userPageInput" class="page-input" min="1" step="1" aria-label="회원목록 페이지 이동">
                            <span id="userPageInfo"></span>
                        </div>
                        <button id="userNextPageBtn" class="secondary">다음</button>
                    </div>
                </div>
            </section>

            <section id="view-generations" class="panel hidden">
                <div class="toolbar">
                    <div class="left">
                        <h2>생성이력</h2>
                        <span id="generationCount" class="status-text"></span>
                    </div>
                </div>

                <div class="panel" style="background:#f9fafb; box-shadow:none; margin-bottom: 15px;">
                    <div class="filters">
                        <div class="search-type">
                            <select id="searchTypeSelect" aria-label="검색 타입">
                                <option value="login_id">사용자 ID</option>
                                <option value="user_id">user ID</option>
                                <option value="session_id">세션 ID</option>
                                <option value="content_type">생성 타입</option>
                                <option value="created_at">생성 날짜</option>
                            </select>
                        </div>
                        <div class="search-field" data-search-scope="generation" data-search-type="login_id">
                            <input type="text" id="filterLoginId" placeholder="예: admin" aria-label="사용자 ID">
                        </div>
                        <div class="search-field hidden" data-search-scope="generation" data-search-type="user_id">
                            <input type="number" id="filterUserId" placeholder="예: 1" aria-label="user ID">
                        </div>
                        <div class="search-field hidden" data-search-scope="generation" data-search-type="session_id">
                            <input type="text" id="filterSessionId" placeholder="session_id" aria-label="세션 ID">
                        </div>
                        <div class="search-field hidden" data-search-scope="generation" data-search-type="content_type">
                            <select id="filterContentType" aria-label="생성 타입">
                                <option value="">전체</option>
                                <option value="image">image</option>
                                <option value="text">text</option>
                            </select>
                        </div>
                        <div class="search-field hidden" data-search-scope="generation" data-search-type="created_at">
                            <input type="date" id="filterCreatedDate" aria-label="생성 날짜">
                        </div>
                        <div class="search-actions">
                            <button id="searchGenerationsBtn" class="primary">검색</button>
                            <button id="resetGenerationsBtn" class="secondary">초기화</button>
                        </div>
                    </div>
                </div>

                <div class="table-scroll">
                    <table>
                        <thead>
                            <tr>
                                <th class="nowrap">사용자</th>
                                <th>입력</th>
                                <th>생성</th>
                                <th>메타 데이터</th>
                                <th>생성 날짜</th>
                            </tr>
                        </thead>
                        <tbody id="generationTableBody"></tbody>
                    </table>
                </div>
                <div class="pagination">
                    <button id="prevPageBtn" class="secondary">이전</button>
                    <div class="status-text">
                        <input type="number" id="pageInput" class="page-input" min="1" step="1" aria-label="페이지 이동">
                        <span id="pageInfo"></span>
                    </div>
                    <button id="nextPageBtn" class="secondary">다음</button>
                </div>
            </section>
        </main>
    </div>

    <div id="loginOverlay" class="login-overlay hidden">
        <div class="login-panel">
            <h3>관리자 로그인</h3>
            <input type="text" id="loginId" placeholder="아이디" autocomplete="username">
            <input type="password" id="loginPw" placeholder="비밀번호" autocomplete="current-password">
            <button id="loginBtn">로그인</button>
            <p id="loginError" class="status-text"></p>
        </div>
    </div>

    <div id="image-modal" class="hidden" onclick="closeImageModal()">
        <span class="close-modal">&times;</span>
        <img id="modal-image" src="" alt="preview">
    </div>

    <div id="text-modal" class="hidden">
        <div class="text-modal-panel">
            <div class="text-modal-header">
                <h3 id="text-modal-title">텍스트 상세</h3>
                <button type="button" class="text-modal-close" id="text-modal-close">닫기</button>
            </div>
            <div id="text-modal-content" class="text-modal-content"></div>
        </div>
    </div>

    <div id="user-modal" class="hidden">
        <div class="text-modal-panel">
            <div class="text-modal-header">
                <h3 id="user-modal-title">사용자 정보</h3>
                <button type="button" class="text-modal-close" id="user-modal-close">닫기</button>
            </div>
            <div id="user-modal-list" class="user-modal-content"></div>
        </div>
    </div>

    <script src="/static/admin.js" defer></script>
</body>

</html>
