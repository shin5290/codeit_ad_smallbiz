<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>AI 광고 챗봇</title>
    <link rel="icon" type="image/png" sizes="16x16" href="/static/favicon.png">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="theme-color" content="#ffffff">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+KR:wght@400;500;600;700&display=swap">
    <link rel="stylesheet" href="/static/main.css">
</head>

<body>
    <header>
        <div class="header-inner">
            <div class="logo">AD Chatbot</div>
            <div class="auth-buttons">
                <span id="userInfo" class="user-info hidden"></span>
                <button id="loginTabBtn" class="btn-secondary hidden" onclick="openModal()">로그인</button>
                <button id="profileEditBtn" class="btn-secondary hidden" onclick="openProfileEditModal()">회원정보
                    수정</button>
                <button id="logoutBtn" class="btn-secondary hidden" onclick="handleLogout()">로그아웃</button>
            </div>
        </div>
    </header>

    <div class="main-container">
        <div class="chat-container">
            <div class="chat-box" id="chatBox">
                <div class="chat-inner" id="chatContent">
                    <div id="chatLoading" class="chat-loading">
                        <div class="chat-spinner"></div>
                        <div>채팅 기록 불러오는 중...</div>
                    </div>
                </div>
            </div>
            <div class="input-area">
                <div class="chat-inner input-inner-wrap">
                    <!-- 미리보기 스트립 -->
                    <div id="previewStrip" class="preview-strip hidden"></div>

                    <!-- 입력/버튼 한 줄 -->
                    <div class="input-row input-inner">
                        <label for="imageUpload" id="imageUploadLabel" class="image-upload-btn"
                            title="이미지 업로드" aria-label="이미지 업로드">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                                <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
                                <circle cx="12" cy="13" r="4"></circle>
                            </svg>
                        </label>
                        <input type="file" id="imageUpload" accept="image/*" hidden onchange="handleImageUpload(event)">

                        <textarea id="userMsg" name="message" class="chat-input" autocomplete="off"
                            placeholder="메시지를 입력하세요... (Shift+Enter 줄바꿈)" rows="1"
                            oninput="handleInputChange(event)" onkeydown="handleInputKeyDown(event)"></textarea>

                        <button id="sendBtn" class="btn-primary btn-round" style="width: 80px; padding: 14px;"
                            onclick="sendChat()" disabled>전송</button>
                    </div>
                </div>
            </div>
            <button id="scrollToBottomBtn" class="scroll-to-bottom hidden" onclick="scrollToLatest()"
                aria-label="최신 메시지로 이동">
                <span class="scroll-label">최신 메시지</span>
                <span class="scroll-arrow">↓</span>
                <span id="scrollToBottomBadge" class="scroll-badge hidden">새 메시지 ↓</span>
            </button>
        </div>
    </div>

    <div id="auth-modal" class="hidden" onclick="closeModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <span class="close-btn" onclick="closeModal()">&times;</span>
            <h2 id="auth-title">로그인</h2>
            <input type="text" id="loginId" name="login_id" placeholder="아이디" autocomplete="username"
                onkeypress="if(event.keyCode==13) handleAuth()">
            <input type="password" id="password" name="login_pw" placeholder="비밀번호" autocomplete="current-password"
                onkeypress="if(event.keyCode==13) handleAuth()">
            <div id="signup-fields" class="hidden">
                <input type="text" id="nickname" placeholder="이름" onkeypress="if(event.keyCode==13) handleAuth()">
            </div>
            <button id="main-btn" class="btn-primary" style="width: 100%;" onclick="handleAuth()">로그인</button>
            <div class="auth-toggle">
                <div class="auth-toggle-text" id="toggle-question">계정이 없으신가요?</div>
                <a class="auth-toggle-link" id="toggle-link" onclick="toggleAuth()">회원가입하기</a>
            </div>
        </div>
    </div>

    <div id="profile-edit-modal" class="hidden" onclick="closeProfileEditModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <span class="close-btn" onclick="closeProfileEditModal()">&times;</span>
            <h2>회원정보 수정</h2>
            <div class="profile-edit-row">
                <label for="editName">이름</label>
                <input type="text" id="editName" placeholder="이름">
            </div>
            <div class="profile-edit-row required">
                <label for="editCurrentPassword">현재 비밀번호</label>
                <input type="password" id="editCurrentPassword" placeholder="현재 비밀번호" required>
            </div>
            <div class="profile-edit-row">
                <label for="editNewPassword">새 비밀번호</label>
                <input type="password" id="editNewPassword" placeholder="변경할 비밀번호 (선택사항)">
            </div>
            <button class="btn-primary" style="width: 100%;" onclick="handleProfileUpdate()">수정하기</button>
        </div>
    </div>

    <!-- 이미지 모달 라이트박스 -->
    <div id="image-modal" class="hidden" onclick="closeImageModal()">
        <span class="close-modal">&times;</span>
        <img id="modal-image" src="" alt="Full size image">
    </div>

    <div id="toast" class="toast" role="status" aria-live="polite"></div>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.8/dist/purify.min.js"></script>
    <script src="/static/main.js" defer></script>
</body>

</html>
