# 이미지 프롬프트 생성 파이프라인 테스트 보고서

**작성일:** 2026-01-20 <br> 
**테스트 대상:** `src/generation/image_generation/prompt/` 모듈 <br> 
**테스트 환경:** Python 3.10, Windows 10 <br>
**YAML 버전:** v3.0.0 (247개 업종 지원)

---

## 목차

1. [개요](#1-개요)
2. [모듈 구조](#2-모듈-구조)
3. [환경 설정](#3-환경-설정)
4. [핵심 모듈 Import 및 초기화](#4-핵심-모듈-import-및-초기화)
5. [프롬프트 생성 파이프라인](#5-프롬프트-생성-파이프라인)
6. [업종 감지 (Industry Detection)](#6-업종-감지-industry-detection)
7. [스타일 라우팅](#7-스타일-라우팅)
8. [전체 파이프라인 통합 테스트](#8-전체-파이프라인-통합-테스트)
9. [테스트 결과 요약](#9-테스트-결과-요약)

---

## 1. 개요

### 1.1 목적
소상공인 247개 업종에 대한 광고 이미지 생성용 프롬프트를 자동으로 생성하는 파이프라인의 사용법 및 테스트 결과를 문서화합니다.

### 1.2 주요 기능
- **한글 입력 → 영어 프롬프트 변환**: GPT API를 활용한 자연어 처리
- **업종 자동 감지**: 한글 키워드 기반 업종 분류 (18개 하위 그룹)
- **업종별 맞춤 프롬프트**: YAML 설정 기반 템플릿 적용
- **스타일 지원**: realistic, semi_realistic, anime 등

### 1.3 지원 업종 구조

| 등급 | 이름 | 하위 그룹 수 | 총 업종 수 |
|------|------|-------------|-----------|
| S | 감성 및 미각 자극 | 4 | 70 |
| A | 비주얼 변화 및 자기관리 | 4 | 50 |
| B | 공간 체험 및 교육 | 3 | 45 |
| C | 신뢰 기반 전문 서비스 | 3 | 50 |
| D | 목적형 소매 및 장비 | 2 | 30 |
| E | 인프라 및 특수 목적 | 2 | 2 |
| **합계** | | **18** | **247** |

---

## 2. 모듈 구조

```
src/generation/image_generation/prompt/
├── __init__.py                 # 모듈 초기화 및 export
├── config_loader.py            # YAML 로더 및 프롬프트 생성기
├── prompt_templates.py         # HybridPromptBuilder, PromptStructure
├── style_router.py             # 스타일별 프롬프트 처리
├── input_parser.py             # 한글→영어 변환 (GPT API)
├── prompt_manager.py           # 통합 프롬프트 관리자
└── config/
    └── industries.yaml         # 247개 업종 설정 (v3.0.0)
```

### 2.1 모듈별 역할

| 모듈 | 클래스/함수 | 역할 |
|------|------------|------|
| `config_loader.py` | `IndustryConfigLoader` | YAML 로드, 업종 감지, 설정 캐시 |
| `config_loader.py` | `PromptGenerator` | 업종별 프롬프트 생성 |
| `prompt_templates.py` | `HybridPromptBuilder` | 템플릿 기반 프롬프트 조합 |
| `prompt_templates.py` | `PromptStructure` | 프롬프트 구조체 (레이어별 관리) |
| `style_router.py` | `StyleRouter` | 스타일별 prefix/suffix 처리 |
| `input_parser.py` | `InputParser` | GPT로 한글→영어 키워드 추출 |

---

## 3. 환경 설정

### 3.1 프로젝트 루트 설정

```python
import sys
from pathlib import Path

# 프로젝트 루트 찾기 (codeit_ad_smallbiz)
current_path = Path.cwd()
project_root = current_path

# scripts/신승목에서 실행 시 상위로 이동
while project_root.name != "codeit_ad_smallbiz" and project_root.parent != project_root:
    project_root = project_root.parent

# 프로젝트 루트가 없으면 현재 경로 기준으로 설정
if project_root.name != "codeit_ad_smallbiz":
    project_root = Path.cwd().parent.parent

# sys.path에 프로젝트 루트 추가
if str(project_root) not in sys.path:
    sys.path.insert(0, str(project_root))

print(f"프로젝트 루트: {project_root}")
```

**출력 예시:**
```
프로젝트 루트: c:\Users\USER\_codeit\_final_project\codeit_ad_smallbiz
```

### 3.2 환경 변수 설정

```python
from dotenv import load_dotenv
import os

load_dotenv()

api_key = os.getenv("OPENAI_API_KEY")
if api_key:
    print(f"✅ OPENAI_API_KEY 로드됨 (길이: {len(api_key)})")
else:
    print("❌ OPENAI_API_KEY가 설정되지 않았습니다.")
```

> **필수 환경변수**: `.env` 파일에 `OPENAI_API_KEY` 설정 필요

---

## 4. 핵심 모듈 Import 및 초기화

### 4.1 기본 Import

```python
# 필요한 라이브러리
import json
import yaml
from pprint import pprint

# 프롬프트 모듈 import
from src.generation.image_generation.prompt.config_loader import (
    IndustryConfigLoader,
    PromptGenerator
)
from src.generation.image_generation.prompt.prompt_templates import (
    HybridPromptBuilder,
    PromptStructure
)
from src.generation.image_generation.prompt.style_router import StyleRouter
```

**출력:**
```
✅ 모든 모듈 import 성공!
```

### 4.2 한글 입력 처리용 Import (GPT API 필요)

```python
from src.generation.image_generation.prompt.input_parser import InputParser
from src.generation.image_generation.prompt.config_loader import (
    IndustryConfigLoader, PromptGenerator
)

# 초기화
parser = InputParser(api_key=api_key)  # 또는 환경변수 자동 사용
loader = IndustryConfigLoader()
generator = PromptGenerator()
```

---

## 5. 프롬프트 생성 파이프라인

### 5.1 기본 사용법 (영어 입력)

```python
# PromptGenerator 초기화
generator = PromptGenerator()

# 업종별 프롬프트 생성
user_input = {
    "product": "strawberry latte",
    "surface": "marble table",
    "theme": "warm",
    "mood": "cozy",
    "style": "realistic"
}

result = generator.generate(
    industry="cafe",  # 또는 "s3_emotional"
    user_input=user_input
)

print(f"Positive: {result['positive']}")
print(f"Negative: {result['negative']}")
print(f"Style: {result['style']}")
```

**출력 예시:**
```
Positive: Professional commercial photography of strawberry latte. placed on marble table.
          soft natural window light streaming gently. cozy and warm atmosphere...
Negative: (빈 문자열 - Z-Image Turbo는 negative prompt 미지원)
Style: realistic
```

### 5.2 업종별 입력 파라미터 예시

| 업종 | 필수 파라미터 | 선택 파라미터 |
|------|-------------|--------------|
| `cafe` | `product` | `surface`, `theme`, `mood` |
| `restaurant` | `dish` | `plating`, `cuisine_style` |
| `gym` | `person_type`, `activity` | `focus` |
| `bakery` | `product` | `presentation`, `theme`, `time` |
| `hair_salon` | `service` | `result` |
| `flower_shop` | `flowers` | `arrangement` |
| `clothing_store` | `item` | `display_method` |

### 5.3 HybridPromptBuilder 직접 사용

```python
import yaml

# YAML에서 템플릿 로드
yaml_path = "src/generation/image_generation/prompt/config/industries.yaml"
with open(yaml_path, 'r', encoding='utf-8') as f:
    config = yaml.safe_load(f)

# 특정 하위 그룹 템플릿 추출
s1_template = config['s_grade']['s1_hot_cooking']

# HybridPromptBuilder로 프롬프트 생성
builder = HybridPromptBuilder(s1_template)

user_input = {
    "dish": "grilled pork belly",
    "presentation": "sizzling on hot plate",
    "theme": "warm",
    "mood": "appetizing"
}

structure = builder.build_from_user_input(user_input)
prompt = structure.build()

print(prompt)
```

**출력:**
```
Professional commercial photography of grilled pork belly. shown sizzling on hot plate.
warm cinematic lighting from above. appetizing and warm atmosphere.
shot on Canon EOS R5 with 85mm lens, natural lighting, shallow depth of field.
with glistening oil on surface, steam rising elegantly, charcoal grill marks visible.
```

---

## 6. 업종 감지 (Industry Detection)

### 6.1 IndustryConfigLoader 사용

```python
loader = IndustryConfigLoader()

# 사용 가능한 업종 목록
print(loader.get_industry_names())
```

**출력:**
```
['s1_hot_cooking', 's2_freshness', 's3_emotional', 's4_neat_variety',
 'a1_beauty', 'a2_wellness', 'a3_fashion', 'a4_delicate_care',
 'b1_learning', 'b2_leisure', 'b3_sports',
 'c1_office', 'c2_medical', 'c3_technical',
 'd1_equipment', 'd2_appliances',
 'e1_infrastructure', 'e2_ceremony']
```

### 6.2 한글 입력으로 업종 감지

```python
test_inputs = [
    "삼겹살 맛집 홍보",
    "카페 딸기라떼",
    "미용실 헤어 염색",
    "헬스장 PT 프로그램",
]

for test_input in test_inputs:
    detected = loader.detect_industry(test_input)
    print(f"입력: {test_input} → 감지: {detected}")
```

**출력:**
```
입력: 삼겹살 맛집 홍보 → 감지: s1_hot_cooking
입력: 카페 딸기라떼 → 감지: s3_emotional
입력: 미용실 헤어 염색 → 감지: a1_beauty
입력: 헬스장 PT 프로그램 → 감지: a2_wellness
```

### 6.3 업종 감지 결과 매핑 표

| 한글 입력 | 감지 업종 | 하위 그룹명 |
|----------|----------|-----------|
| 삼겹살 맛집 | `s1_hot_cooking` | 고온 조리 및 육즙 강조 |
| 횟집 신선한 회 | `s2_freshness` | 신선도 및 색감 강조 |
| 카페 딸기라떼 | `s3_emotional` | 감성 및 부드러운 질감 |
| 한식 백반 정식 | `s4_neat_variety` | 정갈함과 다채로움 |
| 미용실 헤어 염색 | `a1_beauty` | 인물 중심 뷰티 |
| 헬스장 PT 프로그램 | `a2_wellness` | 신체 변화 및 웰니스 |
| 여성복 봄 신상 | `a3_fashion` | 패션 및 스타일 |
| 꽃집 장미 부케 | `a4_delicate_care` | 섬세한 케어 |
| 독서실 스터디 | `b1_learning` | 학습/몰입 |
| 호텔 숙박 | `b2_leisure` | 여가/스테이 |
| 골프 연습장 | `b3_sports` | 스포츠/활동 |
| 변호사 법률 상담 | `c1_office` | 전문 사무 |
| 치과 임플란트 | `c2_medical` | 의료/케어 |
| 타이어 교체 | `d1_equipment` | 중장비/부품 |
| 컴퓨터 수리 | `d2_appliances` | 일반 기기 |
| 주유소 | `e1_infrastructure` | 편의/인프라 |
| 장례식장 | `e2_ceremony` | 예절/의례 |

---

## 7. 스타일 라우팅

### 7.1 지원 스타일 목록

```python
print(StyleRouter.get_supported_styles())
```

**출력:**
```
['realistic', 'ultra_realistic', 'semi_realistic', 'anime']
```

### 7.2 스타일별 Prefix

| 스타일 | Prefix |
|--------|--------|
| `realistic` | Professional commercial photography of |
| `ultra_realistic` | Professional commercial photography of |
| `semi_realistic` | Highly detailed digital artwork of |
| `anime` | Vibrant anime style illustration of |

### 7.3 스타일별 프롬프트 생성

```python
for style in ["realistic", "semi_realistic", "anime"]:
    phrase = StyleRouter.build_subject_phrase(
        style=style,
        subject="strawberry latte",
        additional_context="on marble table in cozy cafe"
    )
    print(f"{style}: {phrase}")
```

**출력:**
```
realistic: Professional commercial photography of strawberry latte. on marble table in cozy cafe
semi_realistic: Highly detailed digital artwork of strawberry latte. on marble table in cozy cafe
anime: Vibrant anime style illustration of strawberry latte. on marble table in cozy cafe
```

---

## 8. 전체 파이프라인 통합 테스트

### 8.1 한글 입력 → 프롬프트 생성 전체 흐름

```python
from src.generation.image_generation.prompt.input_parser import InputParser
from src.generation.image_generation.prompt.config_loader import (
    IndustryConfigLoader, PromptGenerator
)

# 1. 모듈 초기화
parser = InputParser(api_key=api_key)
loader = IndustryConfigLoader()
generator = PromptGenerator()

# 2. 한글 입력
korean_input = "삼겹살 맛집 홍보, 불판에서 지글지글 굽는 모습"

# 3. 업종 감지
detected_industry = loader.detect_industry(korean_input)
print(f"감지 업종: {detected_industry}")

# 4. GPT로 영어 키워드 추출
english_keywords = parser.parse(korean_input, detected_industry)
print(f"영어 키워드: {english_keywords}")

# 5. 프롬프트 생성
result = generator.generate(
    industry=detected_industry,
    user_input=english_keywords
)

print(f"프롬프트: {result['positive']}")
```

**출력 예시:**
```
감지 업종: s1_hot_cooking
영어 키워드: {'dish': 'thick sliced pork belly', 'presentation': 'sizzling on grill', ...}
프롬프트: Professional commercial photography of thick sliced pork belly. in Korean BBQ restaurant...
```

### 8.2 다양한 업종 통합 테스트 결과

| 한글 입력 | 감지 업종 | 프롬프트 시작 부분 |
|----------|----------|------------------|
| 삼겹살 맛집 홍보 | s1_hot_cooking | Professional commercial photography of thick sliced pork belly... |
| 횟집 신선한 회 모듬 | s2_freshness | Professional commercial photography of assorted fresh sashimi... |
| 카페 봄 시즌 딸기 음료 | s3_emotional | Professional commercial photography of strawberry beverage... |
| 미용실 봄 시즌 헤어컬러 | a1_beauty | Professional commercial photography of vibrant hair color... |
| 헬스장 PT 프로그램 | a2_wellness | Professional commercial photography of personal training program... |
| 독서실 쾌적한 스터디 공간 | b1_learning | Professional commercial photography of study space... |
| 변호사 법률 상담 서비스 | c1_office | Professional commercial photography of legal consultation service... |
| 치과 임플란트 시술 | c2_medical | Professional commercial photography of dental implants... |
| 타이어 할인 판매 | d1_equipment | Professional commercial photography of discounted tires... |
| 주유소 위치 안내 | e1_infrastructure | Professional commercial photography of subject... |

---

## 9. 테스트 결과 요약

### 9.1 지원 현황

| 항목 | 값 |
|------|-----|
| YAML 버전 | 3.0.0 |
| 지원 등급 | 6개 (S, A, B, C, D, E) |
| 하위 그룹 | 18개 |
| 총 업종 | 247개 |
| korean_keywords 지원 그룹 | 18/18개 (100%) |

### 9.2 모듈 호환성

| 모듈 | 상태 | 비고 |
|------|------|------|
| `HybridPromptBuilder` | ✅ 호환 | 신규 YAML 템플릿과 정상 작동 |
| `PromptStructure` | ✅ 호환 | 변경 없이 사용 가능 |
| `StyleRouter` | ✅ 호환 | 변경 없이 사용 가능 |
| `IndustryConfigLoader` | ✅ 호환 | 계층 구조 지원 완료 |
| `InputParser` | ✅ 호환 | GPT API 연동 정상 |

### 9.3 알려진 제한 사항

1. **Negative Prompt 미지원**: Z-Image Turbo 모델 특성상 negative prompt를 사용하지 않음
2. **자동차 정비 오감지**: `c3_technical` 대신 `s4_neat_variety`로 감지됨 (korean_keywords 보강 필요)
3. **GPT API 의존성**: 한글→영어 변환에 OpenAI API 키 필요

### 9.4 권장 사용 패턴

```python
# 최소 코드로 프롬프트 생성
from src.generation.image_generation.prompt.input_parser import InputParser
from src.generation.image_generation.prompt.config_loader import (
    IndustryConfigLoader, PromptGenerator
)

# 초기화 (한 번만)
parser = InputParser()
loader = IndustryConfigLoader()
generator = PromptGenerator()

# 프롬프트 생성 (반복 호출)
def generate_prompt(korean_input: str) -> str:
    industry = loader.detect_industry(korean_input)
    keywords = parser.parse(korean_input, industry)
    result = generator.generate(industry=industry, user_input=keywords)
    return result['positive']

# 사용 예시
prompt = generate_prompt("삼겹살 맛집 홍보, 불판에서 지글지글 굽는 모습")
print(prompt)
```

---

## 부록: 참고 파일 경로

| 파일 | 경로 |
|------|------|
| 테스트 노트북 | `scripts/신승목/260119_test.ipynb` |
| 업종 설정 YAML | `src/generation/image_generation/prompt/config/industries.yaml` |
| Config Loader | `src/generation/image_generation/prompt/config_loader.py` |
| Prompt Templates | `src/generation/image_generation/prompt/prompt_templates.py` |
| Style Router | `src/generation/image_generation/prompt/style_router.py` |
| Input Parser | `src/generation/image_generation/prompt/input_parser.py` |

---

**문서 작성:** Claude AI
**최종 수정:** 2026-01-20
